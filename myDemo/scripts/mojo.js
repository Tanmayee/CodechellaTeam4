(function(a){var b=a.Mojo={};b.version="0.9.31";b.exportSymbol=function(b,c){for(var e=b.split("."),f=a,g=0;g<e.length-1;g++)f=f[e[g]];f[e[e.length-1]]=c};b.exportProperty=function(b,a,e){b[a]=e};b.application={};b.interfaces={};b.utils={};b.events={};b.inputStrategies={};b.inputStrategies.validator={};b.flow={};b.model={};b.components={};b.uiComponents={};b.constants={};b.getVersion=function(){return b.version};b.init=function(a){a.enableTraceConsole&&b.enableTraceConsole();for(var c in a)MojoOptions.setOption(c,
a[c]);MojoOptions.validate();MojoOptions.validationOptions.useValidator&&b.inputStrategies.validator.engine.init();(MojoOptions.validationOptions.useValidator||MojoOptions.useFormatter)&&b.inputStrategies.strategies.init(b.inputStrategies.defaultStrategies);MojoOptions.modelDefConfig&&!b.components.registry.has("modelDefResolver")&&b.registerComponent(new b.components.modelDefResolver(MojoOptions.modelDefConfig));b.components.registry.has("expressionEvaluator")||b.registerComponent(new b.components.expressionEvaluator);
b.components.registry.has("viewResolver")||b.registerComponent(new b.components.viewResolver(MojoOptions.viewResolverOptions));b.components.registry.has("flowResolver")||b.registerComponent(new b.components.flowResolver(MojoOptions.flowResolverOptions));b.components.registry.has("actionExecutor")||b.registerComponent(new b.components.actionExecutor(MojoOptions.actionOptions));b.components.registry.has("screenTransitioner")||b.registerComponent(new b.components.screenTransitioner);b.components.registry.has("modalwindow")||
b.registerComponent(new b.components.ModalWindow);b.components.registry.has("abTestResolver")||b.registerComponent(new b.components.abTestResolver(MojoOptions.ABTestConfig));b.application.applicationController.init()};b.registerComponent=function(a){b.components.registry.registerComponent(a)};b.getComponent=function(a){return b.components.registry.get(a)};b.getSome=function(a,c,e,f){b.application.applicationController.startflow(a,c,e,f)};b.loadPage=function(a,c,e){b.application.applicationController.loadPage(a,
c,e)};b.setViewport=function(a){b.application.applicationController.setViewPort(a)};b.doNext=function(a,c){c=c||{};c.nav=a;b.publishEvent(b.constants.events.kNavigation,c)};b.doJump=function(a,c){c=c||{};c.jump=a;b.publishEvent(b.constants.events.kNavigation,c)};b.addDAO=function(a,c){b.model.DAOManager.addDAO(a,c)};b.addModel=function(a){var c;if("string"===typeof a){var e=a,f=arguments[1];c=arguments[2];TRACE("Mojo.addModel() now takes an object",["Mojo","addModel"],b.utils.trace.WARN);if(b.model.registry.has(e))return TRACE("addModel: Model '"+
e+"' already exists. Not adding model"),null;c=new b.DataModel({name:e,defName:c});b.model.registry.addModel(c);f&&b.model.registry.associateWithDAO(c,f);return c}if(a instanceof b.DataModel){c=a;e=c.getName();if(b.model.registry.has(e))return TRACE("addModel: Model '"+e+"' already exists. Not adding model"),null;b.model.registry.addModel(c);1!==arguments.length&&TRACE("When passing in a model, no other parameters are accepted",["Mojo","addModel"],b.utils.trace.WARN);return c}if("object"===typeof a){"string"===
typeof a.model&&(TRACE("Pass in model name as modelName property",["Mojo","addModel"],b.utils.trace.WARN),a.modelName=a.model);if(a.model instanceof b.DataModel){if(!a.autoLoad&&b.model.registry.has(arg.model.getName()))return TRACE("addModel: Model '"+arg.model.getName()+"' already exists. Not adding model."),c=b.getModel(a.model.getName()),a.callback&&a.callback(c),c;b.model.registry.addModel(a.model);a.daoName&&b.model.registry.associateWithDAO(a.model,a.daoName);a.callback&&a.callback(a.model);
return a.model}if("string"===typeof a.modelName){e="boolean"===typeof a.async?a.async:!0;if(!a.autoLoad&&b.model.registry.has(a.modelName))return TRACE("addModel: Model '"+a.modelName+"' already exists. Not adding model."),a.callback&&a.callback(b.getModel(a.modelName)),null;e&&a.defName&&!a.callback&&b.publishEvent(b.constants.events.kException,new MojoException("Mojo: creating model '"+a.modelName+"' asyncronously without a callback.  Your model may not be ready when you use it!",LOG_WARNING));
c=new (b.utils.stringToFunction(a.className||MojoOptions.defaultModelClass||"Mojo.model.dataModel"))({name:a.modelName,defName:a.defFileName,groupId:a.groupId,async:e,callback:function(c){if(c){b.model.registry.addModel(c);a.daoName&&b.model.registry.associateWithDAO(c,a.daoName)}a.callback&&a.callback(c)}})}else TRACE("Mojo.addModel() called with invalid parameters",["Mojo","addModel"],b.utils.trace.ERROR),a.callback&&a.callback();return c}};b.addModels=function(a,c,e){for(var f=a.length,g=0,l=!1,
k=function(a){g+=1;a||(TRACE("Error loading model ",["Mojo.addModels",""],b.utils.trace.ERROR),l=!0);g===f&&(l&&e?e():!l&&c&&c())},o=0;o<f;o++)jQuery.extend(a[o],{callback:k}),b.addModel(a[o])};b.removeModel=function(a){b.model.registry.removeModel(a)};b.getModel=function(a){return b.model.registry.getModel(a)};b.getModelNamesinSystem=function(){return b.model.registry.getModelNamesinSystem()};b.loadModelDefinitions=function(a,c){b.getComponent("modelDefResolver").loadModelDefinitions(a,c)};b.getModelDefinition=
function(a){return b.model.registry.getModelDefinition(a)};b.setData=function(a,c,e,f){b.model.registry.setData(a,c,e,f)};b.setDataInCollection=function(a,c,e,f,g){b.model.registry.setDataInCollection(a,c,e,f,g)};b.getData=function(a,c){return b.model.registry.getData(a,c)};b.getDataVal=function(a){return b.model.registry.getDataVal(a)};b.setDataVal=function(a,c,e){b.model.registry.setDataVal(a,c,e)};b.loadData=function(a){b.model.DAOManager.load(a)};b.saveData=function(a){b.model.DAOManager.save(a)};
b.clearData=function(a){a.includePersitedData&&b.model.DAOManager.destroy(a);b.model.registry.clear(a.modelNames)};b.addInputStrategy=function(a,c){b.inputStrategies.strategies.addStrategy(a,c)};b.overrideInputStrategy=function(a,c){b.inputStrategies.strategies.overrideStrategy(a,c)};b.setABTests=function(a){b.getComponent(b.interfaces.abTestResolver).setABTests(a)};b.applyBindings=function(a){var c=a instanceof jQuery?a:jQuery("#"+a);b.bindings.resolveText(c);b.bindings.bindIterators(c);b.bindings.bindLayout(c);
b.bindings.bindComponents(c);b.bindings.bindData(c);b.bindings.bindEvents(c);MojoOptions.useFormatter&&setTimeout(function(){b.bindings.bindFormatters(c)},0);b.publishEvent(b.constants.events.kBindingsApplied)};b.unbind=function(a){b.bindings.unbindAll(a);b.publishEvent(b.constants.events.kBindingsRemoved)};b.validateSection=function(a,c){var e=!0;return e=b.Validator.validateAll(a,c)};b.validateElement=function(a,c){var e=!0;return e=b.Validator.validateField(a,c)};b.removeErrorTips=function(a){b.Validator.hideErrorTooltips(a)}})(window);
Mojo.constants.components={EVENT:"Event",FLOW_RESOLVER:"FLOW RESOLVER",VIEW_RESOLVER:"VIEW RESOLVER",ACTION_EXECUTOR:"ACTION EXECUTOR",MODELDEF_RESOLVER:"MODLE DEF RESOLVER",FLOW:"FLOW",MODEL:"MODEL"};
Mojo.constants.events={kValidationFailed:"validationFailed",kException:"exception",kDataChange:"dataChange",kNavigation:"navigation",kBeforePageLoad:"beforePageLoad",kPageLoaded:"pageLoaded",kPageFinalized:"pagefinal",kBeforePageUnload:"endPage",kBindingsApplied:"bindingsApplied",kBindingsRemoved:"bindingsRemoved",kProfile:"profile",kModelCreated:"modelCreated",kModelRegistered:"modelRegistered",kFlowStart:"startFlow",kFlowTransition:"flowTransition",kFlowEnd:"endFlow",kStartModalFlow:"startModalFlow",
kEndModalFlow:"endModalFlow",kEndMojo:"endMojo"};Mojo.constants.scopes={kApplicationScope:"APPLICATION_SCOPE",kFlowScope:"FLOW_SCOPE",kViewScope:"VIEW_SCOPE"};Mojo.constants.validateWhenEmpty=["required","requiredIf","requiredIfExpression","groupRequired","groupRequiredMultiple"];Mojo.constants.htmlFunctionPattern=/\$\[fn:((.*?)(\((.*?)\))?)\]/g;Mojo.constants.functionRegex=/^(.*?)(\((.*?)\))?$/;Mojo.constants.nameSpaceRegex=/^([^\s\r\n\'\"]+)\.([^\s\r\n\'\"]+)$/;Mojo.constants.modelNameRegex=/(^[^\s\r\n\'\"]+)$/;
Mojo.constants.modelRegexStr="\\[(([^\\s\\r\\n'\"]+)\\.([^\\s\\r\\n'\"]+))\\]";Mojo.constants.modelRegexNonGreedyStr="\\[(([^\\s\\r\\n'\"\\]\\$\\[]+)\\.([^\\s\\r\\n'\"\\]\\$\\[]+))\\]";Mojo.constants.modelRegex=RegExp("[@\\$]"+Mojo.constants.modelRegexStr);Mojo.constants.modelRegexGlobal=RegExp("[@\\$]"+Mojo.constants.modelRegexStr,"g");Mojo.constants.flowscopeRefGlobal=/FLOW_SCOPE\.([^\s\r\n\'\"]+)/g;Mojo.exportSymbol("MojoConstant",Mojo.constants.events);
(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(d){function c(){!a&&this.construct&&this.construct.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&b.test(d[g])?function(b,a){return function(){var c=this._super;this._super=e[b];var d=a.apply(this,arguments);this._super=c;return d}}(g,d[g]):d[g];c.prototype=f;c.prototype.constructor=c;c.extend=
arguments.callee;return c}})();var LOG_INFO="info",LOG_WARNING="warning",LOG_ERROR="error";Mojo.events.exception=Class.extend({construct:function(a,b,d,c){this.component=a;this.msg=b;this.logType=d?d:LOG_ERROR;this.exeptionObj=c;this.context=[]},addContext:function(a){this.context.push(a)}});Mojo.exportSymbol("MojoException",Mojo.events.exception);
Mojo.events.pubsub=function(){var a={};return{subscribeForEvent:function(b,d,c){!b||!d?TRACE("PubSub invalid usage - need event name and callback",Mojo.utils.trace.WARN):(a[b]||(a[b]={}),c||(TRACE("Callback object is needed in order to be able to unsubscribe and avoid memory leaks.  evt = "+b,["pubsub","subscribeForEvent"],Mojo.utils.trace.WARN),c=window),this.unSubscribeForEvent(b,c),c.__mojo_subscribe_uuid=c.__mojo_subscribe_uuid||Mojo.utils.uuid(),a[b][c.__mojo_subscribe_uuid]={object:c,callback:d},
void 0==c.__mojo_subscribedForEvents&&(c.__mojo_subscribedForEvents=[]),c.__mojo_subscribedForEvents.push(b))},unSubscribe:function(b){if(b){var a=b.__mojo_subscribedForEvents;if(a)for(var c in a)this.unSubscribeForEvent(a[c],b)}},unSubscribeForEvent:function(b,d){if(b&&d){var c=d.__mojo_subscribe_uuid;c&&a[b][c]&&(delete a[b][c],d.__mojo_subscribedForEvents.splice(jQuery.inArray(b,d.__mojo_subscribedForEvents),1))}},publishEvent:function(b,d,c){if(b){TRACE("Publishing Event: "+b,[Mojo.constants.components.EVENT]);
var e=a[b];e?jQuery.each(e,function(a,e){var l=e.object,k=e.callback;if(k&&l)if(c)setTimeout(function(){try{k.call(l,d)}catch(a){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.pubsub","exception thrown in call for event: "+b,LOG_ERROR,a))}},0);else try{k.call(l,d)}catch(o){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.pubsub","exception thrown in call for event: "+b,LOG_ERROR,o))}}):delete a[b]}}}}();
Mojo.exportProperty(Mojo,"publishEvent",Mojo.events.pubsub.publishEvent);Mojo.exportProperty(Mojo,"subscribeForEvent",Mojo.events.pubsub.subscribeForEvent);Mojo.exportProperty(Mojo,"unSubscribe",Mojo.events.pubsub.unSubscribe);Mojo.exportProperty(Mojo,"unSubscribeForEvent",Mojo.events.pubsub.unSubscribeForEvent);
Mojo.model.dataModel=Class.extend({construct:function(a){function b(a){a&&("string"===typeof a?e._groups.push(a):jQuery.isArray(a)&&jQuery.each(a,function(a,b){e._groups.push(b)}))}function d(a,b){var c=Mojo.getComponent("modelDefResolver");if(c)return c.getDef(a,b);TRACE("Model Definition Resolver does not exist - not loading def file for model '"+a+"'","Mojo.dataModel",LOG_WARNING)}function c(a){var b=Mojo.getComponent("modelDefResolver");b?b.getDef(a.modelName,a.defName,function(b){a.success.call(a.context,
b)},function(){a.error.call(a.context)}):(TRACE("Model Definition Resolver does not exist - not loading def file for model '"+a.modelName+"'","Mojo.dataModel",LOG_WARNING),a.success.call(a.context,null))}var e=this;"object"!==typeof a||1!==arguments.length?(TRACE("Deprecated usage.  Constructor now takes exactly 1 object argument.",[Mojo.constants.components.MODEL,this._name],Mojo.utils.trace.WARN),a={name:arguments[0],defName:arguments[1],async:!1}):_.defaults(a,{async:!0});if(!a.name)throw new MojoException("Mojo.model",
"Constructor : 'name' parameter is required to create a model",LOG_ERROR);if(!a.name.match(Mojo.constants.modelNameRegex))throw new MojoException("Mojo.model","Constructor : 'name' is invalid, cannot contain spaces, single or double quotes",LOG_ERROR);a.async&&!a.callback&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.model.dataModel: "+this._name,"creating model asyncronously without a callback.  Your model may not be ready when you use it!",LOG_WARNING));this._id=Mojo.utils.uuid();
this._name=a.name;this._model={};this._attributes={};this._groups=[];this._definition=new Mojo.model.ModelDefinition;a.groupId&&b(a.groupId);a.async?c({modelName:a.name,defName:a.defName,context:this,success:function(c){e._modelDef=c;e._definition=new Mojo.model.ModelDefinition(c);e._mutable=e._definition.mutable();e._definition.groupId()&&b(e._definition.groupId());Mojo.publishEvent(Mojo.constants.events.kModelCreated,{name:e._name,id:e._id,def:e._modelDef,groups:e._groups});e._modelDef||TRACE("Definition for model '"+
a.name+"' does not exist - creating a free form model","Mojo.dataModel",LOG_INFO);e.init();a.callback&&a.callback(e)},error:function(){e.init();a.callback&&a.callback(null)}}):(this._modelDef=d(a.name,a.defName),this._definition=new Mojo.model.ModelDefinition(this._modelDef),this._mutable=this._definition.mutable(),this._definition.groupId()&&b(this._definition.groupId()),Mojo.publishEvent(Mojo.constants.events.kModelCreated,{name:this._name,id:this._id,def:this._modelDef,groups:this._groups}),this._modelDef||
TRACE("Definition for model '"+a.name+"' does not exist - creating a free form model","Mojo.dataModel"),e.init(),a.callback&&a.callback(this))},init:function(){},getName:function(){return this._name},getGroupIds:function(){return this._groups},getDef:function(){return this._modelDef},getDefinition:function(){return this._definition},getDefinitionforKey:function(a){return this._modelDef?this._modelDef[a]:null},setAttribute:function(a,b){this._attributes[a]=b},getAttribute:function(a){return this._attributes[a]},
setDataVal:function(a,b,d){if(!this._mutable&&this._modelDef&&!this._modelDef[a])TRACE("Model: "+this._name+" is not mutable.  Cannot add '"+a+"' to the definition","Mojo.dataModel",LOG_WARNING);else{d=jQuery.extend({silent:!1,force:!1,trim:!1},d);"string"===typeof b&&d.trim&&(b=b.trim());var c=this.getDefinitionforKey(a),e=null,f=b;if(c&&c.readOnly&&!d.force)TRACE("Not setting read-only property'"+a+"' of "+this._name,"Mojo.dataModel",LOG_WARNING);else{if(c&&c.type)switch(e=c.type,e){case "int":"number"!==
typeof b&&(f=parseInt(b),isNaN(f)&&(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.model.dataModel: "+this._name,"failed to convert a non-int value "+b+" into property "+a,LOG_WARNING)),f=b));break;case "bool":"boolean"!==typeof b&&(f=b&&"string"===typeof b&&"true"===b.toLowerCase()?!0:!1);break;case "string":"string"!==typeof b&&(f=b?b.toString():b);break;case "collection":if("object"!==typeof b){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.model.dataModel: "+
this._name,"Trying to set a collection with a value that is not an object - ignoring",LOG_WARNING));return}}this._model[a]!==f&&(c=this._model[a],this._model[a]=f,d.silent||(d={def:this.getDefinitionforKey(a),groupId:this._groupId,modelName:this._name,key:a,val:f,oldval:c,id:this._id},d[this._name+"."+a]=f,Mojo.publishEvent(Mojo.constants.events.kDataChange,d)),TRACE("setDataVal: '"+a+" = "+b+"'",[Mojo.constants.components.MODEL,this._name]))}}},setDataInCollection:function(a,b,d,c){var e=this.getDefinitionforKey(a);
e&&(!e||!e.type||"collection"!==e.type.toLowerCase())?Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.model.dataModel: "+this._name,"'setDataInCollection' has no collection named '"+a+"'",LOG_WARNING)):(c=jQuery.extend({silent:!1,force:!1},c),e&&e.readOnly&&!c.force?TRACE("Not setting read-only property'"+a+"' of "+this._name,"Mojo.dataModel",LOG_WARNING):(this._model[a]||(this._model[a]={}),this._model[a][b]!=d&&(this._model[a][b]=d,c.silent||(c={def:this.getDefinitionforKey(a),
groupId:this._groupId,modelName:this._name,key:a,val:this._model[a],index:b,id:this._id},c[this._name+"."+a]=d,Mojo.publishEvent(Mojo.constants.events.kDataChange,c)),TRACE("setDataInCollection: '"+a+"["+b+"] = "+d+"'",[Mojo.constants.components.MODEL,this._name]))))},getDataInCollection:function(a,b){var d=this._model[a];return _.isArray(d)||_.isObject(d)?d[b]:null},getDataVal:function(a){return this.has(a)?this._model[a]:MojoOptions.defaultModelValue},update:function(a,b){if(null===a||void 0===
a)TRACE("Trying to update model '"+name+"' with a null/undefined object","Mojo.dataModel",LOG_ERROR);else for(var d in a)this.setDataVal(d,a[d],b)},unsetDataVal:function(a,b){this.setDataVal(a,null,{silent:b})},has:function(a){return"undefined"!=typeof this._model[a]},clear:function(a){for(var b in this._model)this.unsetDataVal(b,a)},serialize:function(){try{return Mojo.utils.jsonSerializer.toString(this._model)}catch(a){if(a instanceof MojoException)throw a.addContext("Mojo.model.modelBaseClass - Could not serialize data"),
a;throw new MojoException("Mojo.model.modelBaseClass","Could not serialize data",LOG_ERROR,a);}},deserialize:function(a){try{var b=Mojo.utils.jsonSerializer.toJSON(a);if(b)for(var d in b)this.setDataVal(d,b[d],{force:!0})}catch(c){if(c instanceof MojoException)throw c.addContext("Mojo.model.modelBaseClass - Could not deserialize data"),c;throw new MojoException("Mojo.model.modelBaseClass","Could not deserialize data",LOG_ERROR,c);}}});Mojo.exportSymbol("Mojo.DataModel",Mojo.model.dataModel);
Mojo.interfaces.DAO=Class.extend({interfaceType:"DAO",save:function(){throw new MojoException("Mojo.interfaces.DAO","must implement 'save' function: ",LOG_ERROR);},load:function(){throw new MojoException("Mojo.interfaces.DAO","must implement 'load' function: ",LOG_ERROR);},refresh:function(){throw new MojoException("Mojo.interfaces.DAO","must implement 'refresh' function: ",LOG_ERROR);},destroy:function(){throw new MojoException("Mojo.interfaces.DAO","must implement 'destroy' function: ",LOG_ERROR);
}});Mojo.interfaces.abTestResolver=Class.extend({interfaceType:"abTestResolver",setABTests:function(){throw new MojoException("Mojo.interfaces.abTestResolver","must implement 'setABTests' function: ",LOG_ERROR);},getABTestPage:function(){throw new MojoException("Mojo.interfaces.abTestResolver","must implement 'getABTestPage' function: ",LOG_ERROR);},getABTestFlow:function(){throw new MojoException("Mojo.interfaces.abTestResolver","must implement 'getABTestFlow' function: ",LOG_ERROR);}});
Mojo.interfaces.actionExecutor=Class.extend({interfaceType:"actionExecutor",construct:function(){throw new MojoException("Mojo.interfaces.actionExecutor","must implement 'init' function: ",LOG_ERROR);},execute:function(){throw new MojoException("Mojo.interfaces.actionExecutor","must implement 'execute' function: ",LOG_ERROR);}});
Mojo.interfaces.expressionEvaluator=Class.extend({interfaceType:"expressionEvaluator",parseAndEvaluate:function(){throw new MojoException("Mojo.interfaces.expressionEvaluator","must implement 'parseAndEvaluate' function: ",LOG_ERROR);},evaluate:function(){throw new MojoException("Mojo.interfaces.expressionEvaluator","must implement 'evaluate' function: ",LOG_ERROR);}});
Mojo.interfaces.flowResolver=Class.extend({interfaceType:"flowResolver",construct:function(){throw new MojoException("Mojo.interfaces.flowResolver","must implement 'init' function: ",LOG_ERROR);},resolve:function(){throw new MojoException("Mojo.interfaces.flowResolver","must implement 'reslove' function: ",LOG_ERROR);},isBusy:function(){throw new MojoException("Mojo.interfaces.flowResolver","must implement 'isBusy' function: ",LOG_ERROR);}});
Mojo.interfaces.modalwindow=Class.extend({interfaceType:"modalwindow",construct:function(){throw new MojoException("Mojo.interfaces.modalwindow","must implement 'init' function: ",LOG_ERROR);},show:function(){throw new MojoException("Mojo.interfaces.modalwindow","must implement 'show' function: ",LOG_ERROR);},hide:function(){throw new MojoException("Mojo.interfaces.modalwindow","must implement 'hide' function: ",LOG_ERROR);},getViewPortId:function(){throw new MojoException("Mojo.interfaces.modalwindow",
"must implement 'getViewPortId' function: ",LOG_ERROR);}});
Mojo.interfaces.modelDefResolver=Class.extend({interfaceType:"modelDefResolver",construct:function(){throw new MojoException("Mojo.interfaces.modelDefResolver","must implement 'init' function: ",LOG_ERROR);},getDef:function(){throw new MojoException("Mojo.interfaces.modelDefResolver","must implement 'resolve' function: ",LOG_ERROR);},isBusy:function(){throw new MojoException("Mojo.interfaces.modelDefResolver","must implement 'isBusy' function: ",LOG_ERROR);}});
Mojo.interfaces.screenTransitioner=Class.extend({interfaceType:"screenTransitioner",construct:function(){},transitionScreen:function(){throw new MojoException("Mojo.interfaces.screenTransitioner","must implement 'transitionScreen' function: ",LOG_ERROR);}});
Mojo.interfaces.uiComponent=Class.extend({interfaceType:"uiComponent",create:function(){throw new MojoException("Mojo.interfaces.uiComponent","must implement 'create' function: ",LOG_ERROR);},update:function(){throw new MojoException("Mojo.interfaces.uiComponent","must implement 'update' function: ",LOG_ERROR);},_copyDataAttributes:function(a,b){for(var d=0;d<a[0].attributes.length;d++){var c=a[0].attributes[d];"dataFormatAs"!==c.name&&"implementation"!==c.name&&b.attr(c.name,c.value)}"disabled"!==
a.attr("disabled")&&b.removeAttr("disabled")}});Mojo.interfaces.viewResolver=Class.extend({interfaceType:"viewResolver",construct:function(){throw new MojoException("Mojo.interfaces.viewResolver","must implement 'init' function: ",LOG_ERROR);},resolve:function(){throw new MojoException("Mojo.interfaces.viewResolver","must implement 'reslove' function: ",LOG_ERROR);},isBusy:function(){throw new MojoException("Mojo.interfaces.viewResolver","must implement 'isBusy' function: ",LOG_ERROR);}});
Mojo.utils.trace=function(){function a(a){for(var b=0;b<m.length;b++)if("*"===m[b]||-1!=jQuery.inArray(m[b],a))return!1;return!0}var b={},d={enable:function(a){(c="undefined"!==typeof a?a:!0)?(Mojo.utils.trace.attach(),Mojo.publishEvent(Mojo.constants.events.kConsoleEnabled)):Mojo.publishEvent(Mojo.constants.events.kConsoleDisabled)},attach:function(){e||(jQuery("body").append(g),l=jQuery("#debug_console_viewport"),e=!0)},openWindow:function(){c&&(jQuery("#debug_console_wrapper").animate({height:366},
120),f=!0,jQuery("#debug_console_toggle_button").text("close"))},closeWindow:function(){c&&e&&(jQuery("#debug_console_wrapper").animate({height:0},100),f=!1,jQuery("#debug_console_toggle_button").text("open"))},toggleWindow:function(){f?this.closeWindow():this.openWindow()},addCommand:function(a,c){b[a]=c},removeCommand:function(a){delete b[a]},send:function(b,d,e){if(c){if(e&&"undefined"!=typeof console&&console.log)switch(e){case Mojo.utils.trace.WARN:case LOG_WARNING:console.warn(b,d);break;case Mojo.utils.trace.ERROR:case LOG_ERROR:console.error(b,
d)}b+="<br />";if(d&&0<d.length){"string"===typeof d&&(d=d.split(","));if(-1==jQuery.inArray(d[0],r)){var f=d[0],g=f.replace(/ /g,"_");r.push(d[0]);jQuery("<div style='padding:4px 10px;border-width:0 0 1px;border-style:solid;border-color:#222;background-color:#333;margin-top:1px;'><input type='checkbox' id='"+g+"_checkbox' data-component-name='"+f+"' checked /><label for='"+g+"_checkbox' style='padding-left:5px;'>"+f+"</label></div>").appendTo("#debug_console_component_list");jQuery("#"+g+"_checkbox").change(function(){var a=
jQuery(this).prop("checked"),b=jQuery(this).attr("data-component-name");a?(a=jQuery.inArray(b,m),-1!=a&&m.splice(a,1)):m.push(b)})}if(a(d))b='<span style="color:green;">['+d.join("][")+"]</span> "+b;else return}if(e)switch(e){case Mojo.utils.trace.WARN:case LOG_WARNING:b='<span style="color:orange;">- WARN -</span> '+b;break;case Mojo.utils.trace.ERROR:case LOG_ERROR:b='<span style="color:red;">- Error -</span> '+b;break;case Mojo.utils.trace.DEBUG:case LOG_INFO:b='<span style="color:blue;">- Info -</span> '+
b}k=b+k;null!=l&&-1===o&&(o=setTimeout(function(){var a=jQuery(k);l.prepend(a);k="";o=-1},500))}},clearWindow:function(){l.empty()},sendDelimeter:function(){d.send('<span style="color: #2F4F4F">----------------------------------------------</span>')},addPanel:function(a,b){if(!b)throw new MojoException("Mojo.utils.trace.Console","cannot add panel without options",LOG_WARNING);var c=b.label,e=b.id,f=b.htmlpage;if(!c||!e)throw new MojoException("Mojo.utils.trace.Console","cannot add panel without label and id",
LOG_WARNING);if(!f&&!a)throw new MojoException("Mojo.utils.trace.Console","cannot add panel without a dom element or fileName",LOG_WARNING);0<jQuery("#"+e).length||(jQuery('<div id="'+e+'_button" class="debug_console_menu_toggle_button_off">'+c+"</div>").appendTo("#debug_menu_bar").bind("click",d.onMenuButtonClick),a?jQuery('<div id="'+e+'"></div>').append(a).appendTo("#debug_content").hide():(c=jQuery('<div id="'+e+'"></div>').appendTo("#debug_content").hide(),jQuery(c).load(f)))},onMenuButtonClick:function(a){var a=
a.target,b=jQuery(a).attr("id"),c=b.replace(/_button/g,"");jQuery(a).attr("class","debug_console_menu_toggle_button_on");jQuery("#debug_menu_bar div[id!='"+b+"']").attr("class","debug_console_menu_toggle_button_off");jQuery("#"+c).show();jQuery("#debug_content > div[id!='"+c+"']").hide()}},c=!1,e=!1,f=!1,g=null,l=null,k="",o=-1,r=[],m=[];(function(){var a=!1;jQuery(document).on("mousedown","#debug_menu_bar",function(b){a=!0;b.preventDefault()});jQuery(document).on("mouseup",function(){a=!1});jQuery(window).on("mousemove",
function(b){!1!=a&&(b=jQuery(window).height()-b.clientY,jQuery("#debug_console_wrapper").height(b),jQuery("#debug_console_viewport").height(b-80))})})();g=jQuery('<div id="debug_console_wrapper"><span id="debug_console_toggle_button" title="Toggle" onclick="Mojo.utils.trace.toggleWindow()">open</span><div id="debug_menu_bar"><div id="debugconsole_menu_button" class="debug_console_menu_toggle_button_on" onclick="Mojo.utils.trace.onMenuButtonClick(event)">Mojo Trace</div></div><div id="debug_content"><div id="debugconsole_menu"><pre id="debug_console_viewport"> </pre><pre id="debug_help"><div id="debug_help_inner_container"><b>Top-level Components:</b><div id="debug_console_component_list"></div></div></pre><div class="debug_clear"></div><div id="debug_console_tools"><span class="debug_console_button" title="Add a Delimeter" onclick="Mojo.utils.trace.sendDelimeter()">Delimit</span><span class="debug_console_button" title="Add a Delimeter" onclick="Mojo.utils.trace.clearWindow()">Clear</span><div class="debug_clear"></div></div></div></div></div>')[0];
return d}();Mojo.utils.trace.WARN="warn";Mojo.utils.trace.DEBUG="debug";Mojo.utils.trace.ERROR="error";Mojo.exportProperty(Mojo,"enableTraceConsole",Mojo.utils.trace.enable);Mojo.exportProperty(Mojo,"openConsole",Mojo.utils.trace.openWindow);Mojo.exportProperty(Mojo,"closeConsole",Mojo.utils.trace.closeWindow);Mojo.exportProperty(Mojo,"addDebugPanel",Mojo.utils.trace.addPanel);Mojo.exportProperty(window,"TRACE",Mojo.utils.trace.send);
Mojo.utils.htmlAttrParser={toJSON:function(a){if("string"!==typeof a||!a)return{};var b=null,a=a.trim();"{"!==a.charAt(0)&&(a="{"+a+"}");return(b=Mojo.utils.jsonSerializer.toJSON(a,!0))||{}},toArray:function(a){var a=a.replace(/(^\s*)|(\s*$)/g,""),a=a.replace(/(\s*,\s*)/g,","),a=Mojo.utils.replaceCharWithinParenthesis(a,",","_comma_"),b=a.split(",");jQuery.each(b,function(a,c){c=c.replace(/([a-zA-Z]+\(.+\))+/g,function(a){return a.replace(/\(/,"=").replace(/\)$/,"")});b[a]=c.replace(/_comma_/g,",")});
return b}};
Mojo.utils.jsonSerializer=function(){return{toString:function(a){if(window.JSON&&window.JSON.stringify)return JSON.stringify(a);var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a+'"'),""+a;var d,c,e=[],f=a&&a.constructor==Array;for(d in a){c=a[d];b=typeof c;if("string"==b)c='"'+c+'"';else if("object"==b&&null!==c)c=this.toString(c);else if("function"==b)continue;e.push((f?"":'"'+d+'":')+(""+c))}return(f?"[":"{")+(""+e)+(f?"]":"}")},toJSON:function(a,b){if("string"!==typeof a||!a)return a;
a.trim();a=a.replace(/\0$/,"");try{return window.JSON&&window.JSON.parse&&!b?window.JSON.parse(a):(new Function("return "+a))()}catch(d){throw new MojoException("Mojo.utils.jsonSerializer","Invalid JSON\n"+a,LOG_ERROR,d);}}}}();
(function(a){a.extend(a.support,function(){var a=document.createElement("input");return{inputtypes:function(){var d="search,number,range,color,tel,url,email,date,month,week,time,datetime,datetime-local".split(","),c={};i=0;for(j=d.length;i<j;i++)a.setAttribute("type",d[i]),c[d[i]]="text"!==a.type;return c}(),input:function(){var d="autocomplete,autofocus,list,placeholder,max,min,multiple,pattern,required,step".split(","),c={};i=0;for(j=d.length;i<j;i++)c[d[i]]=!!(d[i]in a);return c}()}}())})(jQuery);
Mojo.utils.extensions=function(){Date.prototype.yyyymmdd=function(){var a=this.getFullYear().toString(),b=(this.getMonth()+1).toString(),d=this.getDate().toString();return a+(b[1]?b:"0"+b[0])+(d[1]?d:"0"+d[0])};String.prototype.toNum=function(a){if(this&&0<this.length){var a="-"===this.charAt(0),b=this.replace(/[^0-9.]/gi,""),b=parseFloat(b);return isNaN(b)?null:a?0-b:b}return a?0:null};String.prototype.toDate=function(){var a=this.match(/(\d{2})[\/|\-](\d{2})[\/|\-](\d{4})/);return a?new Date(a[3],
a[1]-1,a[2]):(a=this.match(/(\d{4})[\/|\-](\d{2})[\/|\-](\d{4})/))?new Date(a[1],a[2]-1,a[3]):(a=this.match(/(\d{2})[\/|\-](\d{4})/))?new Date(a[2],a[1]-1,1):this.match(/\d{4}/)?new Date(this,0,1):new Date(this)};String.trim||(String.prototype.trim=function(){return this&&0<this.length?this.replace(/^[\s]+|[\s]+$/g,""):""});String.prototype.removeQuotes=function(){return this.length==0?void 0:this.replace(/^["|'](.*?)["|']$/,"$1")};String.prototype.toBoolean=function(){switch((this+"").toLowerCase()){case "true":case "1":case "yes":return true}return false};
String.prototype.startsWith=function(a){return this.match("^"+a)==a};String.prototype.endsWith=function(a){return this.match(a+"$")==a};String.prototype.replaceLastInstance=function(a,b){var d=this.lastIndexOf(a);return this.substr(0,d)+b+this.substr(d+a.length)};Number.prototype.toFormattedInt=function(a){if(!this)return"0";var b=this,d=false,c;if(this<0){d=true;b=-b}if(a)c=(c=(new String(b)).split(".")[1])?c:0;b=new String(b.floatToInt());for(a=0;a<Math.floor((b.length-(1+a))/3);++a)b=b.substring(0,
b.length-(4*a+3))+","+b.substring(b.length-(4*a+3));d&&(b="-"+b);c&&(b=b+("."+c));return b};Number.prototype.floatToInt=function(){if(!this)return 0;var a=this,b=false;if(this<0){b=true;a=-a}a=Math.floor(a);b&&(a=-a);return a};Number.prototype.roundToPrecision=function(a){if(!a)throw new zException("invalid param","roundToPrecision");a=Math.pow(10,a);return Math.round(this*a)/a}}();
Mojo.utils.profiler=function(a){var b=a,d={},c={},e=new Date;return{reset:function(){e=new Date;d={};c={}},mark:function(a,b){d[a]=b?b:new Date},captureTimeFromMark:function(a,b){c[a]=b?new Date-d[b]:new Date-e},getCapture:function(a){return c[a]},setName:function(a){b=a},getName:function(){return b},serialize:function(){return b+" : "+Mojo.utils.jsonSerializer.toString(c)}}};
Mojo.utils.uuid=function(){for(var a=[],b=0;36>b;b++)a[b]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]="4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="-";return a.join("")};Mojo.utils.stringToFunction=function(a){for(var a=a.split("."),b=window||this,d=0,c=a.length;d<c;d++)if(b=b[a[d]],!b)return null;return b};
Mojo.utils.resolveModelRefs=function(a){function b(a){for(;d(a);)var c=a.lastIndexOf("$["),e=a.indexOf("]",c),f=a.substring(c,e+1),c=a.substring(c+2,e),c=b(c),a=a.replace(f,c);a=Mojo.getDataVal(a);"object"==typeof a&&(a=Mojo.utils.resolveModelRefs(a));return MojoOptions.treatNullAsBlank&&("undefined"===typeof a||null===a)?"":a}function d(a){var b=a.indexOf("$[");return 0<=b?0<a.indexOf("]",b):!1}if(null==a||"undefined"===typeof a)return a;var c=a;if("object"===typeof a){var e=_.isArray(a)?[]:{};jQuery.each(a,
function(a,b){e[a]=Mojo.utils.resolveModelRefs(b)});return e}if("string"===typeof a){var f=a.match(Mojo.constants.modelRegex);f&&(c=b(f[1]),c=a===f[0]?c:a.replace(f[0],c))}return c};
Mojo.utils.resolveModelRefsInString=function(a,b){if(null==a||"string"!==typeof a)return a;for(var d=a,c=RegExp((b?"\\$":"[@\\$]")+Mojo.constants.modelRegexNonGreedyStr,"g"),e=0;d.match(c)&&8>e;)e+=1,d=d.replace(c,function(a,b){var c=Mojo.getDataVal(b);c||TRACE("No data value found for "+b,["utils","resolveModelRefsInString"],LOG_INFO);return c});return d};
Mojo.utils.evaluateSimpleOperand=function(a){if(!a)return a;var b=a;"string"===typeof b&&(b.match(/^\[(.*?)\]$/)||b.match(/^\{(.*?)\}$/))&&(b=Mojo.utils.jsonSerializer.toJSON(a,!0));b=Mojo.utils.resolveModelRefs(b);return"true"===b?!0:"false"===b?!1:b&&"string"===typeof b?(b=decodeURIComponent(b),isNaN(b.replace(/\,/,""))?(a=b.match(/^'(.*)'$/)||b.match(/^"(.*)"$/))?a[1]:b:parseFloat(b.replace(/\,/,""))):b};
Mojo.utils.splitDataRef=function(a){var b={},d=a.lastIndexOf(".");b.modelName=a.substring(0,d);a=a.substr(d+1);(d=a.match(/^(.+)\[(.*)\]$/))&&3<=d.length?(b.key=d[1],b.index=d[2],b.isCollection=!0):(b.key=a,b.isCollection=!1);return b};Mojo.utils.replaceCharWithinParenthesis=function(a,b,d){for(var c="",e=0,f=0;f<a.length;f++){var g=a.charAt(f);"("===g?e+=1:")"===g&&(e=Math.max(e-1,0));c=g===b&&0<e?c+d:c+g}return c};
Mojo.utils.replaceCommasWithinQuotes=function(a){for(var b="",d=0,c=0,e=0;e<a.length;e++){var f=a.charAt(e);"'"===f&&0===c?d=1-d:'"'===f&&0===d&&(c=1-c);b=","===f&&(0<d||0<c)?b+"_comma_":b+f}return b};
Mojo.utils.getArrayOfArgs=function(a){if(!a||0===a.length)return[];a=Mojo.utils.replaceCommasWithinQuotes(a);a=a.replace(/\s*,\s*/g,",").replace(/^\s*/,"").replace(/\s*$/,"");if(0===a.length)return null;for(var a=a.split(","),b=0;b<a.length;b++)a[b]=a[b].replace(/_comma_/g,","),a[b]=Mojo.utils.evaluateSimpleOperand(a[b]);return a};Mojo.model.ABTestModel=Mojo.model.dataModel.extend({construct:function(a){this._name="ABTest";this._mutable=!1;this._modelDef=null;this._model=a}});
Mojo.model.DAOManager=function(){function a(a,g){function l(){k==m&&(o&&a.error?a.error():!o&&a.success&&a.success())}var a=a||{},k=0,o=!1,r=a.modelNames,m;if(r){"string"===typeof r&&(r=Array(r));var p={};jQuery.each(r,function(a,b){var c=e[b];c&&(p[c]||(p[c]=[]),p[c].push(b))});m=_.keys(p).length;jQuery.each(p,function(a,c){var e=d[a],f=b(c);e[g](f,function(){k++;l()},function(){o=!0;k++;l()})})}else m=_.keys(d).length,jQuery.each(d,function(a,d){var e=b(c[a]);d[g](e,function(){k++;l()},function(){o=
!0;k++;l()})})}function b(a){var b=[];jQuery.each(a,function(a,c){var d=Mojo.model.registry.getModel(c);d&&b.push(d)});return b}var d={},c={},e={};return{addDAO:function(a,b){if(!(b instanceof Mojo.interfaces.DAO))throw new MojoException("Mojo.model.DAOManager","addStrategy: Strategy '"+a+"' does not implement Mojo.interfaces.DAO",LOG_WARNING);d[a]=b;c[a]=[]},associateModelToDAO:function(a,b){c[a]?(c[a].push(b),e[b]=a):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("DAOManager",
"associateModelToDAO: Strategy '"+a+"' has not been added to Mojo, cannot add model '"+b+"'",LOG_WARNING))},save:function(b){a(b,"save")},load:function(b){a(b,"load")},destroy:function(b){a(b,"destroy")}}}();
Mojo.model.ModelDefinition=function(a){var b=a||{},d=a?a.metaData:null,c=a?a.metaData?a.metaData.mutable:!1:!0,e=a?a.metaData?a.metaData.groupId:null:null;this.mutable=function(){return c};this.groupId=function(){return e};this.hasMetaData=function(){return null!==d};this.metaData=function(){return d};this.hasKey=function(b){return _.has(a,b)};this.defForKey=function(a){return this.hasKey(a)?b[a]:null};this.keys=function(){return _.keys(b)}};
Mojo.model.registry=function(){function a(a){var b=Mojo.constants.nameSpaceRegex.exec(a);if(!b||3!=b.length)throw new MojoException("Model Registry","Invalid Model namespace definition: "+a,LOG_ERROR);b[1]===Mojo.constants.scopes.kFlowScope&&(b[1]=Mojo.application.applicationController.getCurrentFlowScopeName());if(!d.getModel(b[1]))throw new MojoException("Model Registry","Model does not exist: "+b[1],LOG_ERROR);return{name:b[1],key:b[2]}}function b(a){TRACE(a,"Model Registry",LOG_WARNING)}var d=
{addModel:function(a){var b=a.getName();if(!(a instanceof Mojo.DataModel))throw new MojoException("Model Registry","Model '"+b+"' must extend from Mojo.DataModel",LOG_ERROR);if(this.has(b))return TRACE("addModel: Model '"+b+"' already exists. Not adding model"),!1;c[b]=a;Mojo.publishEvent(Mojo.constants.events.kModelRegistered,b);this.associateWithGroup(a,a.getGroupIds());return!0},associateWithDAO:function(a,b){b&&Mojo.model.DAOManager.associateModelToDAO(b,a.getName())},associateWithGroup:function(a,
b){b&&jQuery.each(b,function(b,c){e[c]||(e[c]={});e[c][a.getName()]=a})},getModelGroup:function(a){return e[a]},removeModel:function(a){this.has(a)&&((groups=this.getModel(a).getGroupIds())&&jQuery.each(groups,function(b,c){delete e[c][a]}),delete c[a])},has:function(a){return"undefined"!=typeof c[a]},setData:function(a,c,e,k){try{d.getModel(a).setDataVal(c,e,k)}catch(o){b("setData:"+o.msg)}},getData:function(a,c){try{return d.getModel(a).getDataVal(c)}catch(e){return b("getData:"+e.msg),null}},setDataInCollection:function(a,
c,e,k,o){try{d.getModel(a).setDataInCollection(c,e,k,o)}catch(r){b("setDataInCollection:"+r.msg)}},getDataInCollection:function(a,c,e){try{return d.getModel(a).getDataInCollection(c,e)}catch(k){b("getDataInCollection:"+k.msg)}},setDataVal:function(c,e,l){try{var k=a(c);return d.getModel(k.name).setDataVal(k.key,e,l)}catch(o){return b("setDataVal:"+o.msg),null}},getDataVal:function(c){try{var e=a(c);return d.getModel(e.name).getDataVal(e.key)}catch(l){return b("getDataVal:"+l.msg),null}},getModel:function(a){return c[a]},
getModelNamesinSystem:function(){return _.keys(c)},getModelDef:function(a){return c[a].getDef()},getModelDefinition:function(a){return c[a].getDefinition()},getDefforModelElement:function(c){try{var e=a(c);return d.getModel(e.name).getDefinitionforKey(e.key)}catch(l){return b("getDefforModelElement:"+l.msg),null}},clear:function(a){a=a||_.keys(c);"string"===typeof a&&(a=Array(a));jQuery.each(a,function(a,b){b&&d.has(b)&&d.getModel(b).clear()})}},c={},e={};return d}();
Mojo.flow.flowObj=function(a,b){function d(a,b){var c=null,d=n,e=null;if(b)c=a;else if(null==n||null==a){if(!r.has("startState"))return g("No 'startState' defined"),!1;c=q.startState}else{if(!n.transitions)return TRACE("Flow Object: "+m+" - No transitions defined for '"+n.nodeName+"'",LOG_WARNING),!1;e=n.transitions;c=e[a];!c&&e[Mojo.flow.constants.kWildCard]&&(c=e[Mojo.flow.constants.kWildCard])}if(c){n=q[c];if(!n)return b?g("Cannot jump, node does not exist: "+c):g("No Transition for: "+d.nodeName+
" -answer: "+c),!1;n.nodeName=c}else return g("No Transition for: "+d.nodeName+": "+(a||"<EMPTY or NULL>")),!1;d?TRACE("Transition from state '"+d.nodeName+"' response: '"+a+"' to state '"+n.nodeName+"'",[Mojo.constants.components.FLOW,m]):TRACE("Starting flow with state '"+n.nodeName+"'",[Mojo.constants.components.FLOW,m]);Mojo.publishEvent(Mojo.constants.events.kFlowTransition,{name:m,id:p,nodeName:c,stateDef:n,metaData:w,modal:n.options&&n.options.modal?!0:!1});return!0}function c(a){function b(a){if(!a||
!n.options.navWhenDone)n=x;h=!1}if(!h)if(n||g("JSFLow._run - No current state: "),n.state_type||g("No 'state_type' defined for '"+n.nodeName+"'"),n.options&&n.options.modal){switch(n.state_type){case Mojo.flow.constants.kFlowState:Mojo.getSome(n.ref,n.options,o(n.inputVars),b);break;case Mojo.flow.constants.kViewState:Mojo.loadPage(n.ref,n.options,b)}h=!0;s=!1}else{var f=n.state_type;f===Mojo.flow.constants.kViewState&&(x=n);f===Mojo.flow.constants.kViewState||f===Mojo.flow.constants.kFlowState||
f===Mojo.flow.constants.kEndState?"function"===typeof a&&a():f===Mojo.flow.constants.kActionState?e(n,function(b){"string"!==typeof b&&(b=""+b);!1!==d(b)&&("ACTION"===n.state_type&&!0===n.async?c(a):c());"function"===typeof a&&!h&&a()}):g("Invalid State Type: "+f+" in "+n.name)}}function e(a,b){var c=a.ref,d=a.async,e=a.params,h=a.exp;if(c){var f=new Mojo.utils.profiler("ACTION_PROFILE: "+c);f.mark("execute");A.execute({action:c,params:e,async:d,success:function(a){f.captureTimeFromMark("executeTime",
"execute");Mojo.publishEvent(Mojo.constants.events.kProfile,f);TRACE(f.serialize());b(a)},error:function(){b("error")}})}else h?(TRACE("Executing Mojo expression '"+h+"' response: 'undefined'",[Mojo.constants.components.FLOW,m]),c=_expressionEvaluator.parseAndEvaluate(h),b(c)):g("Invalid ACTION node - missing act or exp")}function f(){return{name:m,metaData:w,options:t,id:p}}function g(a){TRACE("Flow error: "+m+" - "+a,["Mojo.flow.flowObj",""],Mojo.utils.trace.ERROR);Mojo.publishEvent(Mojo.constants.events.kException,
new MojoException("Mojo.flow.flowObj","Flow Object: "+m+" - "+a,LOG_ERROR))}function l(a){throw new MojoException("Mojo.flow.flowObj","Flow Object: "+m+" - "+a,LOG_ERROR);}function k(){var a=new Mojo.flow.flowResponse;a.state_type=n.state_type;switch(n.state_type){case Mojo.flow.constants.kFlowState:case Mojo.flow.constants.kViewState:a.value=n.ref;a.options=n.options;a.inputVars=o(n.inputVars);a.metaData=n.metaData;break;case Mojo.flow.constants.kActionState:a.value=n.ref;break;case Mojo.flow.constants.kEndState:n.outcomeExp&&
n.outcome&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.flow.flowObj","Flow '"+m+"' END STATE has both outcome and outcomeExp - ignoring outcomeExp",LOG_WARNING)),n.outcome?a.value=n.outcome:n.outcomeExp&&(a.value=_expressionEvaluator.parseAndEvaluate(n.outcomeExp),TRACE("Ending flow with expression '"+n.outcomeExp+"' response: '"+a.value+"'",[Mojo.constants.components.FLOW,m]))}"string"!==typeof a.value&&(a.value=new String(a.value));a.outputVars=null;a.data=n.data;
a.nodeName=n.nodeName;return a}function o(a){var b=[];if(a)for(var c in a){var d=a[c];"string"===typeof d&&(d=Mojo.utils.resolveModelRefs(d)||"");b[c]=d}return b}var r={init:function(a,b,c,d){function e(a){return{modelName:a.name,defFileName:a.definition,daoName:a.DAO||MojoOptions.defaultDAO,className:a.className||MojoOptions.defaultModelClass}}t=b||{};w=q.metaData||{};_.defaults(w,c);v=new Mojo.DataModel({name:this.getflowScopedModelName(),async:!1});Mojo.addModel(v);if(a)for(var h in a)v.setDataVal(h,
a[h]);if(q.model){a=[];b=q.model;if(jQuery.isArray(b))for(c=0;c<b.length;c++)a.push(e(b[c]));else"object"===typeof b&&a.push(e(b));Mojo.addModels(a,function(){d&&d()},function(){d&&d()})}else d&&d()},start:function(a){function b(){c.doNext(null,function(b){a(b)})}if(s)TRACE("Cannot start flow: "+m+" We are busy");else{Mojo.publishEvent(Mojo.constants.events.kFlowStart,f());var c=this;q.onStart?(TRACE("Starting flow with action '"+q.onStart+"'",[Mojo.constants.components.FLOW,m]),e(q.onStart,b)):b()}},
end:function(a){var b=this;q.onEnd?(TRACE("Ending flow with action '"+q.onEnd+"'",[Mojo.constants.components.FLOW,m]),e(q.onEnd,function(){Mojo.publishEvent(Mojo.constants.events.kFlowEnd,f());Mojo.removeModel(b.getflowScopedModelName());a()})):(Mojo.publishEvent(Mojo.constants.events.kFlowEnd,f()),Mojo.removeModel(b.getflowScopedModelName()),a())},doNext:function(a,b){if(s)TRACE("Cannot doNext in flow: "+m+" We are busy");else if(s=!0,d(a),b)c(function(){var a=k();s=!1;b(a)});else return c(),s=!1,
k()},jumpToState:function(a,b){if(s)TRACE("Cannot jump in flow: "+m+" We are busy");else{s=!0;if(this.allowRandomAccess()){d(a,!0);if(!n)return g("jumpToState: State Name '"+a+"' does not exist!"),null;n.name=a}if(b)c(function(){var a=k();s=!1;b(a)});else return c(),s=!1,k()}},has:function(a){return"undefined"!=typeof q[a]},allowRandomAccess:function(){return this.has("allowRandomAccess")?q.allowRandomAccess:!0},getName:function(){return m},getId:function(){return p},getNodeName:function(){return w.nodeName},
getFlowVariable:function(a){return v.getDataVal(a)},setFlowVariable:function(a,b){return v.setDataVal(a,b)},getflowScopedModelName:function(){return p},isBusy:function(){return s}},m="",p=Mojo.utils.uuid(),q=null,t={},w={},v=null,n=null,x=null,A=null,s=!1,h=!1,m=a,q=b,A=Mojo.getComponent("actionExecutor");_expressionEvaluator=Mojo.getComponent("expressionEvaluator");a||l("Construtor: Flow name not specified");b||l("Construtor: Flow Definition Object not specified");A||l("Action Executor not registered in framework");
return r};Mojo.flow.constants={kViewState:"VIEW",kActionState:"ACTION",kFlowState:"FLOW",kEndState:"END",kWildCard:"*",kNavigationSeperator:"~"};Mojo.flow.constants.historyType={kNever:"never",kSession:"session",kAlways:"always"};
Mojo.flow.controller=function(){function a(b,d,f){if(b<d.length-1){var g=d[b];k.allowRandomAccess()||e("Cannot jump- flow does not allow jump access: "+k.getName());k.has(g.nodeName)||e("Cannot jump- flow: "+k.getName()+" - does not have element: "+g.nodeName);var l=k.jumpToState(g.nodeName);c(l.value,g.inputVars,g.options,l.nodeName,function(){a(b+1,d,f)})}else f()}function b(a,b,c){b?k.jumpToState(a,function(a){d(a,c)}):a?k.doNext(a,function(a){d(a,c)}):k.start(function(a){d(a,c)})}function d(a,
d){var e=a.value;switch(a.state_type){case Mojo.flow.constants.kViewState:d(e);break;case Mojo.flow.constants.kFlowState:c(e,a.inputVars,a.options,a.nodeName,function(){b(null,!1,function(a){d(a)})});break;case Mojo.flow.constants.kEndState:k.end(function(){(k=o.pop())?b(e,!1,function(a){d(a)}):m?m(a):d(a)})}}function c(a,b,c,d,g){g?r.resolve(a,function(l){k&&o.push(k);k=new Mojo.flow.flowObj(a,l);k.__ref=d;k||e("No Flow found for flow reference: "+a);l={path:f.getStateToCurrentFlow(d),nodeName:d};
k.init(b,c,l,g)}):e("_loadFlow() called without callback")}function e(a){throw new MojoException("Mojo.flow.controller",a,LOG_ERROR);}var f={init:function(a){a&&(m=a.onEndCB);k=null;o=[];r=Mojo.getComponent(Mojo.interfaces.flowResolver);g=!0;r||e("Flow Resolver not registered in framework")},navigateTo:function(d,f){g||e("navigateTo : Controller is not initialized!");d||e("No response passed to getNextView");f||e("navigateTo() called without callback");k=null;o=[];var l=d[0],m=d[d.length-1];l instanceof
Mojo.flow.flowJumpObj||e("navigateTo : Start node is not a flowJump Object");m instanceof Mojo.flow.flowJumpObj||e("navigateTo : end node is not a flowJump Object");l===m?c(l.nodeName,l.inputVars,l.options,l.nodeName,function(){b(null,!1,function(a){f(a)})}):c(l.nodeName,l.inputVars,l.options,l.nodeName,function(){a(1,d,function(){b(m.nodeName,!0,function(a){f(a)})})})},getNextView:function(a,c){g||e("getNextView() : Controller is not initialized!");c||e("getNextView() called without callback");a||
e("No response passed to getNextView");try{b(a,!1,function(a){c(a)})}catch(d){throw d;}},getStateToCurrentFlow:function(a){for(var b=[],c=0;c<o.length;c++)b.push({nodeName:o[c].getNodeName(),id:o[c].getId()});b.push({nodeName:a,id:k.getId()});return b},getCurrentFlowVariable:function(a){if(k)return k.getFlowVariable(a)},setCurrentFlowVariable:function(a,b){k&&k.setFlowVariable(a,b)},getCurrentFlowScopeName:function(){if(k)return k.getflowScopedModelName()},isBusy:function(){k&&k.isBusy()&&TRACE("current flow is busy waiting for an async action to complete",
LOG_WARNING);return k&&k.isBusy()||r&&r.isBusy()},getId:function(){return l}},g=!1,l=Mojo.utils.uuid(),k=null,o=null,r=null,m=null;return f};Mojo.flow.flowResponse=function(){this.inputVars=this.options=this.data=this.value=this.state_type=null};Mojo.flow.flowJumpObj=function(a,b,d){this.nodeName=a;this.inputVars=b||null;this.options=d||null};
Mojo.bindings=function(){return{resolveText:function(a){(a instanceof jQuery?a:jQuery("#"+a)).resolveText()},bindData:function(a){a=a instanceof jQuery?a:jQuery("#"+a);jQuery("[data-bind]",a).each(function(){var a=jQuery(this),d=null,c=null;(c=a.attr("data-bind"))&&(d=Mojo.model.registry.getDefforModelElement(c));c=a.is("input")||a.is("select")||a.is("textarea");if(d){if(c){var c=a.attr("data-validate"),e=a.attr("data-format"),f=a.attr("placeholder");d.validate&&!c&&a.attr("data-validate",d.validate.toString());
d.format&&!e&&a.attr("data-format",d.format);d.placeholderText&&!f?(a.attr("placeholder",d.placeholderText),jQuery.support.input.placeholder||a.placeholder()):f&&!jQuery.support.input.placeholder&&a.placeholder();d.accessibility&&a.attr("aria-label",d.accessibility)}c=d.defaultValue;void 0!=c&&null!=c&&(d=Mojo.utils.htmlAttrParser.toJSON(a.attr("data-bind-options")),d.defaultValue=c,a.attr("data-bind-options",Mojo.utils.jsonSerializer.toString(d)))}a.bindToModel()})},bindIterators:function(a){a=a instanceof
jQuery?a:jQuery("#"+a);jQuery(a).find("[data-iterate]").each(function(){jQuery(this).bindIterator()})},bindLayout:function(a){a=a instanceof jQuery?a:jQuery("#"+a);jQuery(a).find("[data-layout]").each(function(){jQuery(this).bindLayout()})},bindComponents:function(a){a=a instanceof jQuery?a:jQuery("#"+a);jQuery(a).find("uiwidget").each(function(){var a=Mojo.components.uiComponentFactory.create(jQuery(this));jQuery(this).replaceWith(a)})},bindEvents:function(a){a=a instanceof jQuery?a:jQuery("#"+a);
jQuery("*[data-event], *[data-set], *[data-nav], *[data-jump], *[data-loadflow], *[data-loadpage]",a).each(function(){jQuery(this).bindEvents()})},bindFormatters:function(a){(a instanceof jQuery?a:jQuery("#"+a)).setFormatters(!0)},unbindAll:function(a){a=a instanceof jQuery?a:jQuery("#"+a);jQuery("*[data-bind], *[data-layout], *[data-iterate]",a).each(function(a,d){var c=jQuery(d);c.unbind();Mojo.unSubscribe(c[0])})}}}();
Mojo.components.uiComponentFactory=function(){return{create:function(a){var b=a.attr("data"),d=null;try{b&&(d=Mojo.utils.htmlAttrParser.toJSON(b),Mojo.utils.resolveModelRefs(d))}catch(c){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("componentBinder","could not pars data specification: "+b))}componentName=a.attr("name");if(b=Mojo.uiComponents.registry.createComponent(componentName))return b.create(a,d);Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("UIComponent",
"The specified component "+b+" is not found in the list of registered components"))}}}();
jQuery.fn.extend({resolveText:function(){var a=Mojo.getComponent("actionExecutor"),b=jQuery(this).html();b.replace(Mojo.constants.htmlFunctionPattern,function(d,c){a.execute({action:c,success:function(a){b=b.replace(d,a)}})});b=Mojo.utils.resolveModelRefsInString(b,!0);b=b.replace(Mojo.constants.flowscopeRefGlobal,function(a,b){return Mojo.application.applicationController.getCurrentFlowScopeName()+"."+b});b=b.replace(/\$\{(.*?)\}/g,'<span data-bind="$1"></span>');jQuery(this).html(b)},bindToModel:function(){function a(a,
b,c){"checkbox"==a.attr("type")?a.prop("checked",b&&"false"!==b):"radio"==a.attr("type")?(val=a.val(),b===val&&a.prop("checked",!0)):a.is("input")||a.is("select")||a.is("textarea")?a.val(b):(a.is("span")||a.is("label")||a.is("a")||a.is("pre")||a.is("h1")||a.is("h2")||a.is("h3"))&&a.text(b);if(c&&c&&"undefined"!=typeof b&&(Mojo.getComponent(Mojo.interfaces.expressionEvaluator),c=c.bindFunction)){var d=Mojo.utils.stringToFunction(c);d?d(b,a):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("DataBinder",
"Bind function not defined: "+c,LOG_WARNING))}}function b(a,b,c){a=Mojo.utils.splitDataRef(a);a.isCollection?d.setDataInCollection(a.modelName,a.key,a.index,b,c):d.setData(a.modelName,a.key,b,c)}var d=Mojo.model.registry,c=jQuery(this),e=c.attr("data-bind");if(e){var f=Mojo.utils.htmlAttrParser.toJSON(c.attr("data-bind-options")),g=Mojo.utils.splitDataRef(e),g=g.isCollection?d.getDataInCollection(g.modelName,g.key,g.index):d.getData(g.modelName,g.key);a(c,g,f);!_.isUndefined(f.defaultValue)&&null===
d.getDataVal(e)&&(g=Mojo.utils.resolveModelRefs(f.defaultValue),a(c,g,f),b(e,g,f));c.is("input")&&("checkbox"==c.attr("type")||"radio"==c.attr("type"))?c.change(function(){var a=null,a=c.attr("type")=="checkbox"?c.prop("checked"):c.val();b(e,a,f)}):(c.is("input")||c.is("select")||c.is("textarea"))&&c.blur(function(){b(e,c.val(),f)});c[0].listen=function(b){var e=jQuery(this).attr("data-bind"),g=e.indexOf("[")>0?e.substr(0,e.indexOf("[")):e;if("undefined"!==typeof b[g]){b=Mojo.utils.splitDataRef(e);
b=b.isCollection?d.getDataInCollection(b.modelName,b.key,b.index):d.getData(b.modelName,b.key);a(c,b,f)}};Mojo.subscribeForEvent(Mojo.constants.events.kDataChange,c[0].listen,c[0])}}});
jQuery.fn.extend({bindEvents:function(){function a(a,b){var c=!1;return function(){c||(a.apply(b?b:this,Array.prototype.slice.call(arguments,0)),c=!0);setTimeout(function(){c=false},500)}}function b(a){a.eventId=Mojo.utils.uuid()}if(this.attr("data-event")){var d=this.attr("data-event"),c=this.attr("data-event-options"),c=Mojo.utils.jsonSerializer.toJSON(c,!0)||{};b(c);this.prop("event-options",c);this.click(function(){"disabled"!==jQuery(this).attr("disabled")&&Mojo.publishEvent(d,jQuery(this).prop("event-options"))})}if(this.attr("data-set")){var c=
this.attr("data-set"),e=Mojo.utils.htmlAttrParser.toJSON(c);this.click(function(){if("disabled"!==jQuery(this).attr("disabled"))for(var a in e){var b=e[a],c=Mojo.utils.splitDataRef(a);c.isCollection?Mojo.setDataInCollection(c.modelName,c.key,c.index,b):Mojo.setData(c.modelName,c.key,b)}})}this.attr("data-loadflow")&&(c=this.attr("data-loadflow-options"),c=Mojo.utils.jsonSerializer.toJSON(c,!0)||{},c.flow=this.attr("data-loadflow"),b(c),this.prop("loadflow-options",c),c=a(function(a){"disabled"!==
jQuery(this).attr("disabled")&&(a.preventDefault(),Mojo.publishEvent(Mojo.constants.events.kNavigation,jQuery(this).prop("loadflow-options")))}),this.click(c));this.attr("data-nav")?(c=this.attr("data-nav-options"),c=Mojo.utils.jsonSerializer.toJSON(c,!0)||{},c.nav=this.attr("data-nav"),b(c),this.prop("nav-options",c),c=a(function(a){if(jQuery(this).attr("disabled")!=="disabled"){a.preventDefault();Mojo.publishEvent(Mojo.constants.events.kNavigation,jQuery(this).prop("nav-options"))}}),this.click(c)):
this.attr("data-jump")?(c=this.attr("data-jump-options"),c=Mojo.utils.jsonSerializer.toJSON(c,!0)||{},c.jump=this.attr("data-jump"),b(c),this.prop("jump-options",c),c=a(function(a){if(jQuery(this).attr("disabled")!=="disabled"){a.preventDefault();Mojo.publishEvent(Mojo.constants.events.kNavigation,jQuery(this).prop("jump-options"))}}),this.click(c)):this.attr("data-loadpage")&&(c=this.attr("data-loadpage-options"),c=Mojo.utils.jsonSerializer.toJSON(c,!0)||{},c.load=this.attr("data-loadpage"),b(c),
this.prop("loadpage-options",c),c=a(function(a){if(jQuery(this).attr("disabled")!=="disabled"){a.preventDefault();Mojo.publishEvent(Mojo.constants.events.kNavigation,jQuery(this).prop("loadpage-options"))}}),this.click(c))}});
jQuery.fn.extend({setFormatters:function(a){var b=jQuery(this).find("[data-format]");jQuery.each(b,function(){var b=jQuery(this),c=b.attr("data-format"),c=Mojo.utils.htmlAttrParser.toArray(c)[0];b.data("formatter",c);b.keyup(function(a){b.format(a)});a&&b.format(jQuery.Event("keydown",{keyCode:38}))})},format:function(a){var b=jQuery(this).data("formatter");b&&(b=b.split("="),Mojo.inputStrategies.strategies.executeStrategy(Mojo.inputStrategies.strategies.FORMAT,jQuery(this),a,b[0],b[1]))}});
jQuery.fn.extend({bindIterator:function(){function a(a){var b="checkbox"==a.attr("type")?a.prop("checked"):a.attr("value"),c=a.attr("data-current-index"),d=a.attr("data-iterator-property"),a=a.closest("[data-iterate]").attr("data-iterate");try{var e=a.split(".")[0],f=a.split(".")[1],g=Mojo.model.registry.getModel(e),k=g.getDataVal(f)[c];k[d]=b;b={};jQuery.extend(!0,b,k);g.setDataInCollection(f,c,b)}catch(l){TRACE("Exception updating model data for iterator "+a,["bindIterator","_updateModelData"],
Mojo.utils.trace.ERROR)}}var b=Mojo.model.registry,d=function(a,b,c){a=a.clone();jQuery.each(a.find("[data-iterator-property]"),function(){var a=jQuery(this),d=a.attr("data-iterator-property"),d=b[d];if("checkbox"==a.attr("type"))a.attr("checked",d&&"false"!==d);else if("radio"==a.attr("type")){var e=a.val();d===e&&a.attr("checked",!0)}else a.is("input")||a.is("select")?a.attr("value",d):a.is("span")||a.is("label")||a.is("a")||a.is("pre")||a.is("h1")||a.is("h2")||a.is("h3")?a.text(d):a.is("div")&&
a.attr("data-iterate-callback")&&(d=a.attr("data-iterate-callback"),(d=Mojo.utils.stringToFunction(d))&&d(a[0],b,c));a.is("input")&&a.attr("data-current-index",c)});jQuery.each(a.find("[data-iterator-filter]"),function(){var a=jQuery(this),c=a.attr("data-iterator-filter");if(c&&(c=Mojo.utils.stringToFunction(c)))(filterResult=c(b))||a.hide()});return a.html().replace(/\$iteratorIndex/g,c)},c=function(a){var c=a.attr("data-iterate"),e=b.getDataVal(c),f=[],g="";if(e instanceof Array){for(var k=0;k<
e.length;k++){var l=d(a[0].originalTemplate,e[k],k,c);f.push(l)}a.empty();k=0;for(c=f.length;k<c;k++)g+=f[k];a.html(g);Mojo.bindings.bindData(a.attr("id"));Mojo.bindings.bindLayout(a.attr("id"))}},e=jQuery(this);if(e.attr("data-iterate-callback"))for(var f=e.attr("data-iterate"),f=b.getDataVal(f),g=0,l=f.length;g<l;g++){var k=Mojo.utils.stringToFunction(callbackFuncName);k&&k(f[g],e[0])}else e[0].originalTemplate=e.clone(),c(e),e[0].listen||(e[0].listen=function(a){var b=jQuery(this);b.attr("data-iterate")===
a.modelName+"."+a.key&&b.is(":visible")&&c(b)},Mojo.subscribeForEvent(Mojo.constants.events.kDataChange,e[0].listen,e[0])),e.on("blur","input[type='text']",function(b){var c=jQuery(this);a(c);b.stopPropagation()}),e.on("change","input[type='checkbox']",function(b){var c=jQuery(this);a(c);b.stopPropagation()}),e.on("change","input[type='radio']",function(b){var c=jQuery(this);a(c);b.stopPropagation()})}});
jQuery.fn.extend({bindLayout:function(){function a(a){if(d.visible){var g=function(c){c?jQuery(b).parent().is(":hidden")?b.show():l.transitionFunc?l.transitionFunc(b,!0):a?b.show():b.show("fast"):jQuery(b).parent().is(":hidden")||a?b.hide():(Mojo.removeErrorTips(b),l.transitionFunc?l.transitionFunc(b,!1):b.hide("fast"))},l=d.visible;l.fn?e.execute({action:l.fn,$el:b,success:function(a){g(a)}}):l.exp?g(c.parseAndEvaluate(l.exp)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: visible",
"Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.visible),LOG_ERROR))}if(d.disabled){var k=function(a){a?(jQuery(b).attr("disabled","disabled"),jQuery(b).addClass("disabled")):(jQuery(b).removeAttr("disabled"),jQuery(b).removeClass("disabled"))},o=d.disabled;o.fn?e.execute({action:o.fn,$el:b,success:function(a){k(a)}}):o.exp?k(c.parseAndEvaluate(o.exp)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: disabled","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.disabled),
LOG_ERROR))}if(d.css){var r=function(a){p?(_.isString(p)&&(p=[p]),jQuery.each(p,function(c,d){a?b.addClass(d):b.removeClass(d)})):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: css","no classes to change",LOG_WARNING))};try{var m=d.css,p=m.className;if(m.fn)e.execute({action:m.fn,$el:b,success:function(a){r(a)}});else if(m.exp)r(c.parseAndEvaluate(m.exp));else if(m.modelVal){var q=m.modelVal.match(Mojo.constants.modelRegex),p=q?Mojo.getDataVal(q[1])||"":m.modelVal;
r(!0)}else Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: css","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.css),LOG_ERROR))}catch(t){t instanceof MojoException&&t.addContext("Invalid css: "+Mojo.utils.jsonSerializer.toString(d.css)),Mojo.publishEvent(Mojo.constants.events.kException,t)}}if(d.style){var w=function(a){n?jQuery.each(n,function(c,d){a?b.css(c,d):b.css(c,"")}):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: style",
"CSS style prop is missing.",LOG_WARNING))};try{var v=d.style,n=v.prop||{};v.fn?e.execute({action:v.fn,$el:b,success:function(a){w(a)}}):v.exp?w(c.parseAndEvaluate(v.exp)):v.modelVal?((q=v.modelVal.match(Mojo.constants.modelRegex))?(n=Mojo.getDataVal(q[1]),n=Mojo.utils.jsonSerializer.toJSON(n,!0)):n=v.modelVal,w(!0)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: style","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.style),LOG_ERROR))}catch(x){x instanceof
MojoException&&x.addContext("Invalid style: "+Mojo.utils.jsonSerializer.toString(d.style)),Mojo.publishEvent(Mojo.constants.events.kException,x)}}if(d.attr){var A=function(a){s.name?jQuery(b).attr(s.name,a):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: attr","Invalid specification: missing 'name': "+Mojo.utils.jsonSerializer.toString(d.attr),LOG_ERROR))};try{var s=d.attr;if(s.fn)h=e.execute({action:s.fn,$el:b,success:function(a){A(a)}});else if(s.exp)A(c.parseAndEvaluate(s.exp));
else if(s.modelVal){var q=s.modelVal.match(Mojo.constants.modelRegex),h;h=q?Mojo.getDataVal(q[1])||"":s.modelVal;A(h)}else Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: attr","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.attr),LOG_ERROR))}catch(u){u instanceof MojoException&&u.addContext("Invalid attr: "+Mojo.utils.jsonSerializer.toString(d.attr)),Mojo.publishEvent(Mojo.constants.events.kException,u)}}if(d.replaceText){var F=function(a){jQuery(b).text(a)};
try{var C=d.replaceText;C.fn?h=e.execute({action:C.fn,$el:b,success:function(a){F(a)}}):C.exp?F(c.parseAndEvaluate(C.exp)):C.modelVal?(h="",(q=C.modelVal.match(Mojo.constants.modelRegex))?F(Mojo.getDataVal(q[1])||""):F(C.modelVal)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: replaceText","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.replaceText),LOG_ERROR))}catch(H){H instanceof MojoException&&H.addContext("Invalid replaceText: "+Mojo.utils.jsonSerializer.toString(d.replaceText)),
Mojo.publishEvent(Mojo.constants.events.kException,H)}}if(d.prepend){var I=function(a){a&&(b.is(":input")?b.is(":input")&&b.before("<span>"+z+"</span>"):b.text(z+b.text()))};try{var D=d.prepend,z=D.placeBefore||"";D.fn?doPrepend=e.execute({action:D.fn,$el:b,success:function(a){I(a)}}):D.exp?I(c.parseAndEvaluate(D.exp)):D.modelVal?(z=(q=D.modelVal.match(Mojo.constants.modelRegex))?Mojo.getDataVal(q[1]):D.modelVal,I(!0)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: prepend",
"Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.prepend),LOG_ERROR))}catch(E){E instanceof MojoException&&E.addContext("Invalid prepend: "+Mojo.utils.jsonSerializer.toString(d.prepend)),Mojo.publishEvent(Mojo.constants.events.kException,E)}}if(d.append){var J=function(a){z?a&&(b.is(":input")?b.is(":input")&&b.after("<span>"+B.placeAfter+"</span>"):b.text(b.text()+B.placeAfter)):a&&(b.is(":input")?b.is(":input")&&b.after("<span>"+z+"</span>"):b.text(b.text()+z))};try{var B=d.append,
z=B.placeAfter||"";B.fn?doAppend=e.execute({action:B.fn,$el:b,success:function(a){J(a)}}):B.exp?J(c.parseAndEvaluate(B.exp)):B.modelVal?(z=(q=B.modelVal.match(Mojo.constants.modelRegex))?Mojo.getDataVal(q[1]):B.modelVal,J(!0)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("LayoutBinder: append","Invalid specification: "+Mojo.utils.jsonSerializer.toString(d.append),LOG_ERROR))}catch(G){G instanceof MojoException&&G.addContext("Invalid append: "+Mojo.utils.jsonSerializer.toString(d.append)),
Mojo.publishEvent(Mojo.constants.events.kException,G)}}}var b=jQuery(this),d=b.attr("data-layout"),c=Mojo.getComponent("expressionEvaluator"),e=Mojo.getComponent("actionExecutor");d&&(d=Mojo.utils.htmlAttrParser.toJSON(d),d.listen&&(b[0].listen=function(b){function c(d){"undefined"!==typeof b[d]&&a(!1)}jQuery(this);var e=d.listen;jQuery.isArray(e)?jQuery.each(e,function(a,b){c(b)}):c(e)},Mojo.subscribeForEvent(Mojo.constants.events.kDataChange,b[0].listen,b[0])),a(!0))}});
Mojo.enableValidationPlugin=function(a){jQuery.fn.validate=function(b){var d=function(a){var b={},a=Mojo.utils.replaceCharWithinParenthesis(a,":","_colon_"),c=a.split(":");jQuery.each(c,function(a,b){c[a]=b.replace(/_colon_/g,":")});var d=c[0].replace(/([a-zA-Z]+\(.+\))+/g,function(a){return a.replace(/\(/,"=").replace(/\)$/,"")}),d=d.split("=");b.type=d[0];b.args=d[1]?d[1].replace(/_comma_/g,","):null;b.options={};for(a=1;a<c.length;a+=1)d=c[a].replace(/([a-zA-Z]+\(.+\))+/g,function(a){return a.replace(/\(/,
"=").replace(/\)$/,"")}),d=d.split("="),b.options[d[0]]=d[1]?d[1].replace(/_comma_/g,",").replace(/_colon_/g,":").removeQuotes():null;return b};if(!this.attr("data-validate"))return"";for(var c=null,e="",f=function(a){var a=a.replace(/(^\s*)|(\s*$)/g,""),a=a.replace(/(\s*,\s*)/g,","),a=Mojo.utils.replaceCharWithinParenthesis(a,",","_comma_"),a=a.split(","),b=[];jQuery.each(a,function(a,c){b.push(d(c))});return b}(this.attr("data-validate")),g=0;g<f.length;g++)if(c=f[g],c.options.message&&this.data(c.type+
"_msg",c.options.message),c=a.executeStrategy(Mojo.inputStrategies.strategies.VALIDATE,this,null,c.type,c.args))if(Mojo.publishEvent(Mojo.constants.events.kValidationFailed,this.get(0)),e+=c+"<br />",!b)break;return e}};
Mojo.inputStrategies.baseStrategy=Class.extend({exceptions:null,allowException:!1,regex:null,defaultMessage:null,getError:function(a,b){return a.data(this.name+"_msg")||this.defaultMessage||b},construct:function(){this.allowException=!1;this.maskChar="#"},validate:function(a){var b=a.val();if((!this.allowException||!(this.exceptions&&"object"===typeof this.exceptions)||!this.containedInExceptions(b))&&this.regex&&!RegExp(this.regex).test(b))return this.getError(a,"Invalid Entry")},formatAgainstMask:function(a,
b){var d=0,c=0,e=this.mask,f="",g=null,l=null,k;if(!this.allowException||!(this.exceptions&&"object"===typeof this.exceptions)||!this.containedInExceptions(b,!0)){for(k=this.getCaretPos(a)||0;d<b.length&&c<e.length;)if(g=e.charAt(c),l=b.charAt(d),g===l&&this.maskChar!==l)f+=l,d++,c++;else{if(!isNaN(parseInt(l))&&f.length<=e.length)for(g=c;g<=e.length;g++)if(e.charAt(g)===this.maskChar){f+=l;c++;break}else f+=e.charAt(g),k>d&&k++,c++;d++}a.val(f);k&&this.setCaretPos(a,k)}},getCaretPos:function(a){var b=
0;if("textarea"===a[0].tagName.toLowerCase())return Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.BaseStrategy.formatAgainstMask","formatter set on a TextArea element, can only be used on text inputs.",LOG_ERROR)),b;try{if(document.selection){var d=document.selection.createRange();d.moveStart("character",-a[0].value.length);b=d.text.length}else b=a[0].selectionStart}catch(c){TRACE("Could not get caret position")}return b},setCaretPos:function(a,b){try{if(document.selection){var d=
a[0].createTextRange();d.collapse(!0);d.moveEnd("character",b);d.moveStart("character",b);d.select()}else a[0].setSelectionRange(b,b)}catch(c){TRACE("Could not set caret position")}},containedInExceptions:function(a,b){var d=!1;if(this.exceptions){a&&(a=a.toLowerCase(),a=a.replace(/ /g,""));for(var c=0;c<this.exceptions.length;c++){var e=this.exceptions[c].toLowerCase(),e=e.replace(/ /g,"");if(a===e){d=!0;break}else if(b&&0==e.indexOf(a)){d=!0;break}}}return d}});
Mojo.exportSymbol("Mojo.InputStrategy",Mojo.inputStrategies.baseStrategy);
Mojo.inputStrategies.defaultStrategies={required:{validate:function(a){var b=this.validateAgainstType(a);if(b)return this.getError(a,b)},validateAgainstType:function(a){switch(a.prop("type")){default:if(!a.val())return"This field is required";break;case "checkbox":if(!a.prop("checked"))return"This checkbox is required";break;case "radio":var b=jQuery("body"),a=a.attr("name");if(0==b.find("input:radio[name='"+a+"']:checked").size())return"Please select an option";break;case "select-one":if(!a.val())return"This field is required";
break;case "select-multiple":if(!a.find("option:selected").val())return"This field is required"}}},requiredIf:{validate:function(a,b){var d=Mojo.inputStrategies.strategies.getStrategy("required").validateAgainstType(a);if(null!=b&&"undefined"!==typeof b&&""!==b&&d)return this.getError(a,d)}},requiredIfExpression:{validate:function(a,b){var d=Mojo.getComponent("expressionEvaluator"),c=Mojo.inputStrategies.strategies.getStrategy("required").validateAgainstType(a);if(!0===d.parseAndEvaluate(b)&&c)return this.getError(a,
c)}},groupRequired:{validate:function(a,b){a.val();var d=jQuery("input[data-validate*='groupRequired'], input[data-validate*='"+b+"']");if(1<d.filter(function(){return 0!==this.value.length}).length)return this.getError(a,"Only one field can be entered");if(1!=d.size()-d.filter('input:text[value=""]').length)return this.getError(a,"One of these fields is required")}},groupRequiredMultiple:{validate:function(a,b){a.val();var d=jQuery("input[data-validate*='groupRequiredMultiple'], input[data-validate*='"+
b+"']");if(d.size()==d.filter('input:text[value=""]').length)return this.getError(a,"One of these fields needs to have a value")}},maxLength:{validate:function(a,b){var d=a.val(),b=parseInt(b,10);isNaN(b)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.maxLength","maxLength validation set with non numeric arguement of: "+b,LOG_ERROR));this._max=b;if(d.length>b)return this.getError(a,"Maximum "+b+" characters allowed")},format:function(a,b,d){d=parseInt(d,
10);isNaN(d)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.maxLength","maxLength validation set with non numeric arguement of: "+d,LOG_ERROR));!isNaN(d)&&_.isNumber(d)&&a.is("input")&&a.is("input")&&a.val().length>=d&&a.val(a.val().slice(0,d))}},minLength:{validate:function(a,b){var d=a.val(),b=parseInt(b,10);isNaN(b)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.minLength","minLength validation set with non numeric arguement of: "+
b,LOG_ERROR));if(_.isNumber(b)&&!isNaN(b)&&d.length<b)return this.getError(a,"Minimum "+b+" characters required")}},exactLength:{validate:function(a,b){var d=a.val(),b=parseInt(b,10);isNaN(b)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.exactLength","exactLength validation set with non numeric arguement of: "+b,LOG_ERROR));if(_.isNumber(b)&&!isNaN(b)&&d.length!=b)return this.getError(a,"Value must be "+b+" characters")},format:function(a,b,d){d=parseInt(d,
10);isNaN(d)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.exactLength","exactLength validation set with non numeric arguement of: "+d,LOG_ERROR));a.is("input")&&_.isNumber(d)&&!isNaN(d)&&a.val().length>=d&&a.val(a.val().slice(0,d))}},max:{validate:function(a,b){var d=a.val().replace(/\,/g,""),b=parseFloat(b),d=parseFloat(d);(isNaN(b)||!_.isNumber(b))&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.max",
"max validation set with non numeric arguement of: "+length,LOG_ERROR));if(isNaN(d)||!_.isNumber(d)||parseFloat(d)>parseFloat(b))return this.getError(a,"Maximum value is "+b)}},min:{validate:function(a,b){var d=a.val().replace(/\,/g,""),b=parseFloat(b),d=parseFloat(d);isNaN(b)&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.min","min validation set with non numeric arguement of: "+length,LOG_ERROR));if(isNaN(d)||!_.isNumber(d)||parseFloat(d)<parseFloat(b))return this.getError(a,
"Minimum value is "+b)}},multipleOf:{validate:function(a,b){var d=parseFloat(a.val().replace(/\,/g,"")),b=parseFloat(b);(!_.isNumber(b)||isNaN(b))&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.defaultStrategies.min","min validation set with non numeric arguement of: "+length,LOG_ERROR));if(isNaN(d)||!_.isNumber(d)||0!==parseFloat(d)%parseFloat(b))return this.getError(a,"Must be a multiple of "+b)}},same:{validate:function(a,b,d,c){var e=a.val(),b=jQuery("#"+b),b=b.val()?
b.val():b.text();if(c&&e.toLowerCase()!==b.toLowerCase())return this.getError(a,"Field must be same as "+d);if(!c&&e!==b)return this.getError(a,"Field must be same as "+d+" (Case Sensitive)")}},sameTrimmed:{validate:function(a,b,d,c){var e=jQuery.trim(a.val()),b=jQuery("#"+b),b=b.val()?b.val():b.text(),b=jQuery.trim(b);if(c&&e.toLowerCase()!==b.toLowerCase())return this.getError(a,"Field must be same as "+d);if(!c&&e!==b)return this.getError(a,"Field must be same as "+d+" (Case Sensitive)")}},notSame:{validate:function(a,
b,d,c){var e=a.val(),b=jQuery("#"+b),b=b.val()?b.val():b.text();if(c&&e.toLowerCase()===b.toLowerCase())return this.getError(a,"Field cannot be same as "+d);if(!c&&e===b)return this.getError(a,"Field cannot be same as "+d+" (Case Sensitive)")}},notSameTrimmed:{validate:function(a,b,d,c){var e=jQuery.trim(a.val()),b=jQuery("#"+b),b=b.val()?b.val():b.text(),b=jQuery.trim(b);if(c&&e.toLowerCase()===b.toLowerCase())return this.getError(a,"Field cannot be same as "+d);if(!c&&e===b)return this.getError(a,
"Field cannot be same as "+d+" (Case Sensitive)")}},equalsVal:{validate:function(a,b){if(a.val()!==b+"")return this.getError(a,"Value must be "+b)}},notEqualsVal:{validate:function(a,b){if(a.val()===b+"")return this.getError(a,"Value cannot be "+b)}},email:{regex:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,
getError:function(a){return this._super(a,"Invalid email address")}},ssn:{exceptions:["applied for","died","tax exempt","LAFCP","unknown"],defaultRegex:/^\d\d\d\-\d\d\-\d\d\d\d$/,altRegex:/^\d\d\-\d\d\d\d\d\d\d$/,defaultMask:"###-##-####",altMask:"##-#######",getError:function(a){return this._super(a,this.allowException?"Invalid SSN":"Invalid SSN, must be "+this.mask)},validate:function(a,b,d){var c=a.val();this.allowException=b;this.regex=this.defaultRegex;this.mask=this.defaultMask;b&&c.match(/^\d\d\-/)&&
(this.regex=this.altRegex,this.mask=this.altMask);var e=this._super(a);if(!e&&d&&!b){var b=!1,f=c.replace(/[^0-9]/g,""),c=f.substr(0,3),d=f.substr(3,2),f=f.substr(5,4);900>c&&0!=c&&0!=d&&0!=f?b=!0:899<c&&69<d&&81>d&&(b=!0);b||(e="Invalid Social security number")}return!e?null:this.getError(a,e)},format:function(a,b,d){b=a.val();""!=b&&(this.allowException=d,this.mask=this.defaultMask,d&&b.match(/^\d\d\-/)&&(this.mask=this.altMask),this.formatAgainstMask(a,b))}},regex:{validate:function(a,b,d){this.errorMsg=
d;this.regex=RegExp(b);return this._super(a)},getError:function(a){return this._super(a,this.errorMsg)}},date:{exceptions:"various,inherit,inherited,continue,continues,none".split(","),defaultMask:"MM/DD/YYYY",getError:function(a){return this._super(a,"Invalid '"+this.mask+"' date")},validate:function(a,b,d){var c=a.val();"boolean"===typeof b?(this.allowException=b,this.mask=d||this.defaultMask):"boolean"===typeof d?(this.allowException=d,this.mask=b||this.defaultMask):(this.mask=b||this.defaultMask,
this.allowException=!1);var e,f,g;switch(this.mask){case "MM/YYYY":this.regex=/^(?:0?[1-9]|1[0-2])\/(?:19\d\d|20\d\d)$/;b=c.split("/");e=b[0];g=b[1];break;case "YYYY":this.regex=/^(?:19\d\d|20\d\d)$/;g=c;break;case "YYYY-MM-DD":this.regex=/^(?:19\d\d|20\d\d)\-(0?[1-9]|1[0-2])\-(0?[1-9]|[12][0-9]|3[01])$/;b=c.split("-");e=b[1];f=b[2];g=b[0];break;case "MM/DD":this.regex=/^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|[12][0-9]|3[01]))$/;b=c.split("/");e=b[0];f=b[1];break;default:this.regex=/^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|[12][0-9]|3[01]))(\/|-)(?:19\d\d|20\d\d)$/,
b=c.split("/"),e=b[0],f=b[1],g=b[2]}e=parseInt(e);f=parseInt(f);(e=((g=parseInt(g))&&!e&&!f?1900<=g&&2100>g:e&&1>e||12<e||f&&1>f||31<f||(4==e||6==e||9==e||11==e)&&30<f||2==e&&29<f?0:f&&2==e?0==g%4&&0!=g%100||0==g%400?29>f:29>=f:1)?null:"Invalid date range")||(e=this._super(a));if(e)return this.getError(a,e)},format:function(a,b,d,c){var e=a.val(),f="";""!=e&&(this.allowException=c,this.mask=d=d||this.defaultMask,this.mask=this.mask.replace(/[A-Za-z]/gi,"#"),f=e,-1<d.indexOf("YYYY")&&f.charAt(6)&&
f.charAt(7)&&"/"===f.charAt(5)&&!f.charAt(8)&&(d=f.substr(6,2),"19"!==d&&"20"!==d&&jQuery.isNumeric(parseInt(d,10))&&(c=13<parseInt(d,10)?"19":"20",f=f.slice(0,5)+c+d,a.val(f),this.setCaretPos(a,this.getCaretPos(a)+2),this.formatAgainstMask(a,f))),8==b.which||46==b.which||this.formatAgainstMask(a,f))}},before:{validate:function(a,b,d){var c=a.val();try{var e=c.toDate(),f;switch(b){case "today":case "now":f=new Date;break;default:f=b.toDate()}c=!0;return(c=d?e.yyyymmdd()<=f.yyyymmdd():e.yyyymmdd()<
f.yyyymmdd())?null:this.getError(a,"Date entered must be"+(d?" on or":"")+" before "+b)}catch(g){}}},after:{validate:function(a,b,d){var c=a.val();try{var e=c.toDate(),f;switch(b){case "today":case "now":f=new Date;break;default:f=b.toDate()}c=!0;return(c=d?e.yyyymmdd()>=f.yyyymmdd():e.yyyymmdd()>f.yyyymmdd())?null:this.getError(a,"Date entered must be"+(d?" on or":"")+" after "+b)}catch(g){}}},phone:{regex:/^\(\d\d\d\) \d\d\d[\-]\d\d\d\d$/,defaultMask:"(###) ###-####",getError:function(a){return this._super(a,
"Invalid phone number, must be "+this.mask)},validate:function(a,b){var d=a.val();this.mask=b||this.defaultMask;var c=this.mask.replace(/#/g,"\\d").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\./g,"\\.");this.regex=RegExp(""+("^"+c+"$"));c=this._super(a);c||(d=d.replace(/[^0-9]/g,""),"0"==d.charAt(0)&&(c="first digit cannot be 0 or 1"),"0"==d.charAt(3)&&(c="fourth digit cannot be 0 or 1"));return c},format:function(a,b,d){b=a.val();""!=b&&(this.mask=d||this.defaultMask,this.formatAgainstMask(a,
b))}},number:{regex:/^[\-\+]?(\d+(\,\d{3})*\.?\d{0,9}|\.\d{1,9})$/,defaultPrecision:"2",getError:function(a){return this._super(a,"Invalid number")},validate:function(a,b){a.val();this.precision=b||this.defaultPrecision;var d;d="[\\-\\+]?(\\d+(,\\d{3})*\\.?\\d{0,PRE}|\\.\\d{1,PRE})".replace(/PRE/g,this.precision);this.regex=RegExp(""+("^"+d+"$"));return this._super(a)},format:function(a){var b=a.val();if(""!=b)return b=b.replace(/,/g,"").split("."),b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.val(b.join("."))}},
numberOnly:{regex:/^[0-9]+$/,getError:function(a){return this._super(a,"Value is not a number")},format:function(a){var b=a.val();return""==b?void 0:0==b.replace(/[0-9]/gi,"").length?b:a.val(b.replace(/[^0-9]/g,""))}},alpha:{regex:/^[a-zA-Z]*$/gi,getError:function(a){return this._super(a,"Value must be all letters")},format:function(a){var b=a.val();return""==b?void 0:0==b.replace(/[A-Za-z]/gi,"").length?b:a.val(b.replace(/\d/g,"").replace(/\W/g,""))}},alphaNumeric:{regex:/^([a-zA-Z0-9]+)$/,getError:function(a){return this._super(a,
"Should be alphanumeric")},format:function(a){var b=a.val();return""==b?void 0:0==b.replace(/[a-zA-Z0-9]/gi,"").length?b:a.val(b.replace(/[^0-9a-zA-Z]/g,""))}},maskedNumber:{regex:/^$/,defaultMask:"",getError:function(a){return this._super(a,"Invalid input, format must be "+this.mask)},validate:function(a,b){a.val();this.mask=b||this.defaultMask;var d=this.mask.replace(/([^a-zA-Z0-9#])/g,"\\$1"),d=d.replace(/#/g,"\\d");this.regex=RegExp(""+("^"+d+"$"));return this._super(a)},format:function(a,b,d){b=
a.val();""!=b&&(this.mask=d?d:this.defaultMask,this.formatAgainstMask(a,b))}},zip:{regex:/^\d{5}(\-\d{4})?$/,defaultMask:"#####-####",validate:function(a,b){var d=a.val();this.mask=this.defaultMask;if(b&&10!=d.length)return this.getError(a,"Invalid zip code, must be #####-####");if(!(5===d.length||10===d.length))return this.getError(a,"Invalid zip code, must be #####  or  #####-####")},format:function(a){var b=a.val();""!=b&&(this.mask=this.defaultMask,this.formatAgainstMask(a,b))}},creditCard:{defaultMask:"################",
validate:function(a){var b=a.val().replace("-","").replace(/\s/g,""),d=b.slice(0,2);if("34"===d||"37"===d){if(15!==b.length)return errString;b="0"+b}else if(16!==b.length)return errString;for(var c=d=0,e=b.length-1;0<=e;e--)d=parseInt(b.charAt(e),10),e%2?c+=d:(d*=2,10<=d?(c+=Math.floor(d/10),c+=d%10):c+=d);if(0!==c%10)return this.getError(a,"Invalid Credit Card Number")},format:function(a){var b=a.val(),d=b.slice(0,2);this.mask="34"===d||"37"===d?"###############":this.defaultMask;""!==b&&this.formatAgainstMask(a,
b)}},rtn:{validate:function(a){var b=a.val(),d=!1;if(b.match("[-\\d]+")&&(b=b.replace(/-/,""),9==b.length)){var c=b.substring(0,2).toNum();if(!(1<=c&&12>=c||21<=c&&32>=c))return this.getError(a,"Invalid Routing Transit Number");for(var c=0,e=[3,7,1,3,7,1,3,7],f=0;f<e.length;f++)c+=e[f]*b.charAt(f).toNum();b.charAt(8).toNum()==(10-c%10)%10&&(d=!0)}if(!d)return this.getError(a,"Invalid Routing Transit Number")}}};
Mojo.inputStrategies.strategies=function(){function a(a){jQuery.each(a,function(a,c){var d;if("object"!=typeof c)throw new MojoException("Mojo.inputStrategies.strategies","Invalid strategy definition - must be an object: '"+c+"'",LOG_ERROR);d=new (Mojo.InputStrategy.extend(c));d.name=a;b[a]=d});d=!0}var b={},d=!1;return{VALIDATE:"validate",FORMAT:"format",init:function(b){d||a(b)},addStrategy:function(a,d){d instanceof Mojo.inputStrategies.baseStrategy?(b[a]&&TRACE("Mojo.inputStrategies.strategies.addStrategy: Overwriting "+
a),b[a]=d):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.inputStrategies.strategies","addStrategy: "+a+" must subclass Mojo.inputStrategies.baseStrategy",LOG_WARNING))},overrideStrategy:function(a,d){b[a]?(jQuery.extend(b[a],d),TRACE("Mojo.inputStrategies.strategies.addStrategy: overriding "+a)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.inputStrategies.strategies","overrideStrategy: "+a+" does not exist - not overriding",LOG_WARNING))},
getStrategy:function(a){return b[a]},executeStrategy:function(a,d,f,g,l){d.val();var k=null,o=b[g];if(o){if(o[a]){args=Mojo.utils.getArrayOfArgs(l);try{if(!d.val()&&0>jQuery.inArray(g,Mojo.constants.validateWhenEmpty))return"";args.splice(0,0,d);a===Mojo.inputStrategies.strategies.FORMAT&&args.splice(1,0,f);k=o[a].apply(o,args)}catch(r){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.inputStrategies.strategies","Invalid "+a+" definition "+g+": "+l,LOG_WARNING,r))}return k}Mojo.publishEvent(Mojo.constants.events.kException,
new MojoException("Mojo.inputStrategies.strategies","Missing action:"+a+" for strategy:"+g,LOG_WARNING))}else Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.inputStrategies.strategies","Missing strategy: '"+g+"'",LOG_WARNING))}}}();
Mojo.inputStrategies.validator.engine=function(){function a(a){var b=a.data("errorTooltip");b&&b.fadeOut(100,function(){b.remove()});a.removeData("errorTooltip");a.removeAttr("hasErrorTip")}function b(a){var b=0<a.offset().top-70?a.offset().top-70:0;jQuery("html,body").animate({scrollTop:b},"fast");a.focus()}function d(b,c,d){var e=b.offset().left,f=b.offset().top,m=e+b.width(),p;p=b.attr("data-validate-options");p=Mojo.utils.jsonSerializer.toJSON(p,!0)||{};var q=p.tooltipPosition||d.tooltipPosition||
MojoOptions.validationOptions.tooltipPosition||"top",t=void 0!==p.hideOnFocus?p.hideOnFocus:d.hideOnFocus||MojoOptions.validationOptions.hideOnFocus;switch(q){case "right":p="errorTooltipArrowLeft";break;case "bottom":p="errorTooltipArrowUp";break;default:p="errorTooltipArrowDown"}b.attr("hasErrorTip",!0);b.data("errorTooltip")&&b.data("errorTooltip").is(":visible")?(d=b.data("errorTooltip"),d.html(c+"<div class='"+p+"' />")):(d=jQuery("<div class='errorTooltip' style=''>"+c+"<div class='"+p+"'></div></div>"),
d.appendTo("body").hide().fadeIn(120),b.data("errorTooltip",d));switch(q){case "right":d.css("left",m+14);d.css("top",f+(b.outerHeight()-d.outerHeight())/2);break;case "bottom":d.css("left",e);d.css("top",f+b.outerHeight()+9);break;default:d.css("left",e),d.css("top",f-d.outerHeight()-7)}d.unbind("click").bind("click",function(){a(jQuery(b))});t&&!b.prop("clickHandlerSet")&&(b.prop("clickHandlerSet",!0),b.on("click",function(){a(jQuery(this))}))}function c(){f||(Mojo.enableValidationPlugin(Mojo.inputStrategies.strategies),
f=!0)}var e={init:function(){f||c()},validateAll:function(a,b){var d=a instanceof jQuery?a:jQuery("#"+a),o=b||{};f||c();this.hideErrorTooltips(d);var r=!0;jQuery(d).find("[data-validate]").not(":hidden").not(":disabled").each(function(a,b){b=jQuery(b);r=e.validateField(b,o,r)?r:!1});return r},validateField:function(g,l,k){var g=g instanceof jQuery?g:jQuery("#"+g),o=l||{};f||c();g.prop("blurAttached")||(g.prop("blurAttached",!0),g.bind("blur",function(){e.validateField(jQuery(this),l)}));var r=!0===
o.suppressErrors,m=o.showOnlyOne||MojoOptions.validationOptions.showOnlyOne,p=g.validate(o.showMultipleErrorsPerInput||MojoOptions.validationOptions.showMultipleErrorsPerInput);if(p){if("radio"==g.prop("type")){var q=g.prop("name"),q=jQuery.find("input:radio[name='"+q+"']:first");if(g[0]!=q[0])return!1}r||(!m||0===jQuery(".errorTooltip:visible").length)&&d(g,p,o);k&&b(g);return!1}a(g);return!0},hideErrorTooltips:function(b){(b?b instanceof jQuery?b:jQuery("#"+b):jQuery("body")).find("[hasErrorTip]").andSelf().each(function(b,
c){a(jQuery(c))})}},f=!1;return e}();Mojo.exportSymbol("Mojo.Validator",Mojo.inputStrategies.validator.engine);
Mojo.components.abTestResolver=Mojo.interfaces.abTestResolver.extend({_abTests:{},_abtestConfig:{},active:!1,construct:function(a){this._abtestConfig=a},setABTests:function(a){var b={};Mojo.model.registry.removeModel("ABTest");this.active=!1;this._abTests={};this._abtestConfig&&this._abtestConfig.tests&&(_.each(a,function(a,c){this._abTests[c]=a;this._abtestConfig.tests[c]&&this._abtestConfig.tests[c][a]&&(this.active=!0,_.each(this._abtestConfig.tests[c][a].vars,function(a,c){b[c]?TRACE("Conflicting ABTest variable: "+
c,["Mojo.components.abTestResolver","setABTests"],Mojo.utils.trace.ERROR):b[c]=a}))},this),a=new Mojo.model.ABTestModel(b),Mojo.model.registry.addModel(a))},getABTestPage:function(a,b){if(!this.active)return null;var d=this._abtestConfig.testRoot||"",c=null,e;for(e in this._abTests){var f=this._abTests[e];if(this._abtestConfig.tests[e]&&this._abtestConfig.tests[e][f]&&_.isArray(this._abtestConfig.tests[e][f].views)&&0<=_.indexOf(this._abtestConfig.tests[e][f].views,a)){c=d+"/"+e+"/"+f+"/"+this._stripDefaultRoot(b);
break}}return c},getABTestFlow:function(a,b){if(!this.active)return null;var d=this._abtestConfig.testRoot||"",c=null,e;for(e in this._abTests){var f=this._abTests[e];if(this._abtestConfig.tests[e]&&this._abtestConfig.tests[e][f]&&_.isArray(this._abtestConfig.tests[e][f].flows)&&0<=_.indexOf(this._abtestConfig.tests[e][f].flows,a)){c=d+"/"+e+"/"+f+"/"+this._stripDefaultRoot(b);break}}return c},_stripDefaultRoot:function(a){var b=this._abtestConfig.mainRoot;if(!b||0===b.length)return a;/\/$/.test(b)||
(b+="/");return 0!==a.indexOf(b)?a:a.substr(b.length)}});
Mojo.components.actionExecutor=Mojo.interfaces.actionExecutor.extend({construct:function(a){this._pathToActions=null;if(!a)throw new MojoException("ActionExecutor","missing options",LOG_ERROR);if("undefined"==typeof a.pathToActions)throw new MojoException("ActionExecutor","options missing path variable",LOG_ERROR);if("object"===typeof a.pathToActions){if(this._pathToActions=a.pathToActions,!a.pathToActions["default"])throw new MojoException("ActionExecutor","pathToActions must contain a 'default' entry.",
LOG_ERROR);}else if("string"===typeof a.pathToActions)this._pathToActions={"default":a.pathToActions};else throw new MojoException("ActionExecutor","pathToActions is invalid.  Must be an object or string.",LOG_ERROR);},execute:function(a){function b(a,b,c,d){"undefined"!=typeof b&&"object"!=typeof b&&(b=b.split(","));b||(b=[]);if("function"===typeof a)c?(b.push(d),a.apply(this,b)):(a=a.apply(this,b),d&&d(a));else throw new MojoException("ActionExecutor","Javascript action '"+a+"' does not exist. Check your function (case sensitive, or misnamed).",
LOG_ERROR);}if(!a||"object"!==typeof a)return Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.actionExecutor","execute: args must be an object",LOG_ERROR)),null;var d=a.action,c=a.params,e=a.async,f=a.success,g=a.error,l=null,k=null,o="default",r="",m=null,p=null;if(!d)return Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.actionExecutor","execute: no action passed in",LOG_ERROR)),null;if(!f)return Mojo.publishEvent(Mojo.constants.events.kException,
new MojoException("Mojo.components.actionExecutor","execute: no success passed in",LOG_ERROR)),null;c&&"object"!==typeof c&&(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.actionExecutor","execute: parameters not passed as array - ignoring them",LOG_WARNING)),c=null);if(d=Mojo.constants.functionRegex.exec(d))l=d[1],k=Mojo.utils.getArrayOfArgs(d[3]),a.$el&&k.push(a.$el);0==k.length&&c&&"object"===typeof c&&jQuery.each(c,function(a,b){k.push(Mojo.utils.evaluateSimpleOperand(b))});
a=l.split(".");try{if(1==a.length)if(p=window[l],"function"===typeof p)b(p,k,e,f,g);else throw new MojoException("ActionExecutor","Action: '"+l+"' does not exist in global namesapce",LOG_ERROR);else if(action=a[a.length-1],o=a.slice(0,-1).join("."),r=a[0],m=this._pathToActions[o],m||(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("ActionExecutor","Path alias '"+o+"' not found, using default path",LOG_INFO)),m=this._pathToActions["default"]),m.match(/\/$/)||(m+="/"),p=Mojo.utils.stringToFunction(l))TRACE("Action already loaded: "+
l,[Mojo.constants.components.ACTION_EXECUTOR]),p=Mojo.utils.stringToFunction(l),b(p,k,e,f,g);else{var q=m+r+".js";TRACE("Loading action class: "+q,[Mojo.constants.components.ACTION_EXECUTOR]);jQuery.getScript(q,function(){p=Mojo.utils.stringToFunction(l);b(p,k,e,f,g)}).fail(function(a,b,c){a=new MojoException("Mojo.components.actionExecutor","Load Error: "+q+" - Context: "+c,LOG_ERROR);Mojo.publishEvent(Mojo.constants.events.kException,a);g&&g(a)})}}catch(t){o=new MojoException("Mojo.components.actionExecutor",
"Invalid action "+l,LOG_ERROR),TRACE("Invalid action: "+l,["Mojo.components.actionExecutor","execute"],Mojo.utils.trace.ERROR),Mojo.publishEvent(Mojo.constants.events.kException,o),g&&g(o)}}});
Mojo.components.registry=function(){var a=[];return{registerComponent:function(b){if(!b.interfaceType)throw new MojoException("Mojo.components.registry","Register: component must implement a Mojo interface: ",LOG_ERROR);this.has(b.interfaceType)&&(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.registry","Replacing component: "+b.interfaceType,LOG_WARNING)),delete a[b.interfaceType]);a[b.interfaceType]=b},get:function(b){if("string"===typeof b){if(this.has(b))return a[b];
Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.registry","Component '"+b+"' not found in registry: ",LOG_WARNING));return null}if("function"===typeof b)for(var d in a)if(a[d]instanceof b)return a[d];Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.components.registry","Component not found in registry: ",LOG_WARNING));return null},has:function(b){return"undefined"!=typeof a[b]}}}();
Mojo.components.expressionEvaluator=Mojo.interfaces.expressionEvaluator.extend({parseAndEvaluate:function(a){parts=a.match(/\[(.+?)\]+|\((.+?)\)+|\{(.+?)\}+|\'(.+?)\'+|\"(.+?)\"+|[^\s]+/g);jQuery.each(parts,function(a,d){parts[a]=d.removeQuotes()});return this.evaluate(parts)},evaluate:function(a){for(var b=0;b<a.length;b++)a[b]=this._evaluateOperand(a[b]);if(3==a.length){var b=a[0],d=a[2],a=a[1];switch(a){case "eq":return b===d;case "notEq":return b!==d;case "lt":case "lte":case "gt":case "gte":if(isNaN(b)||
isNaN(d))throw new MojoException("ExpressionEvaluator","'lt, lte, gt, gte' expressions must have numbers for both operands.",LOG_ERROR);switch(a){case "lt":return b<d;case "lte":return b<=d;case "gt":return b>d;case "gte":return b>=d}break;case "inArr":if("object"!==typeof d)throw new MojoException("ExpressionEvaluator","'inArr' expression must have an array as second operand.",LOG_ERROR);return-1<jQuery.inArray(b,d)||b&&-1<jQuery.inArray("*",d);case "notInArr":if("object"!==typeof d)throw new MojoException("ExpressionEvaluator",
"'notInArr' expression must have an array as second operand.",LOG_ERROR);return-1===jQuery.inArray(b,d)||b&&-1<jQuery.inArray("*",d);case "or":return b||d;case "and":return b&&d;default:throw new MojoException("ExpressionEvaluator","Invalid operator: '"+a+"'. for 3 word expression",LOG_ERROR);}}else if(2==a.length)switch(b=a[1],a=a[0],a){case "valueOf":return b;case "hasValue":return null!=b&&"undefined"!==typeof b&&""!==b;case "createModel":return"object"===typeof b?Mojo.addModel(b):"string"===typeof b&&
Mojo.addModel({modelName:b}),!0;default:throw new MojoException("ExpressionEvaluator","Invalid operator: '"+a+"'. for 2 word expression",LOG_ERROR);}else{if(1==a.length)return a[0];throw new MojoException("ExpressionEvaluator","Javascript expression is invalid.",LOG_ERROR);}},_evaluateOperand:function(a){var b;if(!a)return a;b=a;if("object"===typeof a||"boolean"===typeof a)return b;this._isContainedExpression(a)?b=this.parseAndEvaluate(this._getContainedExpression(a)):this._isObject(a)&&(b=Mojo.utils.jsonSerializer.toJSON(a,
!0));b=Mojo.utils.resolveModelRefs(b);"true"===b&&(b=!0);"false"===b&&(b=!1);"null"===b&&(b=null);"undefined"===typeof b&&(b="");b&&"string"===typeof b&&!isNaN(b.replace(/\,/g,""))&&(b=parseFloat(b.replace(/\,/,"")));return b},_isContainedExpression:function(a){return a.match(/^\((.*?)\)$/)},_isObject:function(a){return a.match(/^\[(.*?)\]$/)||a.match(/^\{(.*?)\}$/)},_getContainedExpression:function(a){return a.replace(/^\((.*?)\)$/,"$1")}});
Mojo.components.flowResolver=Mojo.interfaces.flowResolver.extend({kWildCard:"*",construct:function(a){this._map=this._pathToFlows=null;this._loadedDefs=[];if(!a)throw new MojoException("Flow Resolver","missing options",LOG_ERROR);if("object"===typeof a.pathToFlows){this._pathToFlows=a.pathToFlows;for(var b in this._pathToFlows)for(var d;null!=(d=/\$\{(.*?)\}/g.exec(this._pathToFlows[b]));)if(this._pathToFlows.hasOwnProperty(d[1]))this._pathToFlows[b]=this._pathToFlows[b].replace(d[0],this._pathToFlows[d[1]]);
else throw new MojoException("Flow Resolver",d[0]+" variable cannot be found.",LOG_ERROR);if(!this._pathToFlows["default"])throw new MojoException("Flow Resolver","pathToFlows must contain a 'default' entry.",LOG_ERROR);}else if("string"===typeof a.pathToFlows)this._pathToFlows={"default":a.pathToFlows};else throw new MojoException("Flow Resolver","pathToFlows is invalid.  Must be an object or string.",LOG_ERROR);if("object"===typeof a.aliasMap)this._map=a.aliasMap;else throw new MojoException("Flow Resolver",
"aliasMap is invalid.  Must be an object",LOG_ERROR);},resolve:function(a,b){var d="default",c=a,e=null,f=null,g=null;this._abTestResolver||(this._abTestResolver=Mojo.getComponent(Mojo.interfaces.abTestResolver));if(!b)throw new MojoException("Flow Resolver","resolve() called without callback",LOG_ERROR);(e=Mojo.constants.nameSpaceRegex.exec(a))?(d=e[1],c=e[2]):null!=a&&(d=a);e=this._pathToFlows[d];e||(TRACE("Path alias '"+d+"' not found, using default path","Flow Resolver"),e=this._pathToFlows["default"]);
e.match(/\/$/)||(e+="/");this._map[a]?(f=this._map[a],TRACE("ALIAS REF: '"+a+"' --\> "+f,[Mojo.constants.components.FLOW_RESOLVER])):this._map[this.kWildCard]&&(f=c+this._map[this.kWildCard],TRACE("WILDCARD REF: '"+c+"' --\> "+f,[Mojo.constants.components.FLOW_RESOLVER]));g=e+f;if(d=this._abTestResolver.getABTestFlow(a,g))TRACE(a+" --\> "+d,[Mojo.constants.components.FLOW_RESOLVER,"ABTEST"]),g=d;f?this._loadedDefs[g]?(TRACE("Loading flow out of memory: '"+f+"'",[Mojo.constants.components.FLOW_RESOLVER]),
b(this._loadedDefs[g])):this._loadDef(g,function(c){this._loadedDefs[g]=c;TRACE("Loading flow off server: '"+a+"' --\> "+g,[Mojo.constants.components.FLOW_RESOLVER]);b(c)},this):b(null)},_loadCount:0,isBusy:function(){return 0<this._loadCount},_loadDef:function(a,b,d){var c=this;try{c._loadCount+=1,jQuery.ajax({url:a,success:function(a){a="string"===typeof a?jQuery.parseJSON(a):a;c._loadCount-=1;b.call(d,a)},error:function(b,d,e){c._loadCount-=1;"parsererror"===d?Mojo.publishEvent(Mojo.constants.events.kException,
new MojoException("Flow Resolver","Parse Error: "+a+" - Context: "+e,LOG_ERROR)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Flow Resolver","Load Error: "+a+" - Context: "+e,LOG_ERROR))}})}catch(e){if(e instanceof MojoException)throw e;throw new MojoException("Flow Resolver","UNKNOWN EXCEPTION:  "+flow,LOG_ERROR,e);}}});
Mojo.components.ModalWindow=Mojo.interfaces.modalwindow.extend({construct:function(){$modalBg=jQuery("#modalBgContainer");$modalBg[0]||jQuery("<div></div>",{id:"modalBgContainer"}).appendTo("body").hide()},show:function(a,b){this.create();var d=jQuery("#modalContainer"),c=jQuery("#modalClose"),e=jQuery("#modalBgContainer");a?(c.click(function(){b&&b()}),c.show(0)):(c.unbind("click"),c.hide(0));d.is(":hidden")&&(d.fadeIn().css("display","inline-block"),e.show())},hide:function(){var a=jQuery("#modalWrapper"),
b=jQuery("#modalClose"),d=jQuery("#modalBgContainer");b.unbind("click");a.remove();d.hide();this.closeCB=null},create:function(){a=jQuery("#modalContainer");if(!a[0]){var a=jQuery("<div />",{id:"modalWrapper"}).appendTo("body"),a=jQuery("<div></div>",{id:"modalContainer"}).appendTo(a).hide();jQuery("<div></div>",{id:"modalInnerContainer"}).appendTo(a);jQuery("<div></div>",{id:"modalClose"}).appendTo(a).hide()}},getViewPortId:function(){return jQuery("#modalInnerContainer").attr("id")}});
Mojo.components.modelDefResolver=Mojo.interfaces.modelDefResolver.extend({construct:function(a){this._map=this._pathToModelDefs=null;this._defaultExtension=".json";this._loadedDefs={};if(!a)throw new MojoException("ModelDefResolver","missing options",LOG_ERROR);if("object"===typeof a.pathToModelDefs){this._pathToModelDefs=a.pathToModelDefs;for(var b in this._pathToModelDefs)for(var d;null!=(d=/\$\{(.*?)\}/g.exec(this._pathToModelDefs[b]));)if(this._pathToModelDefs.hasOwnProperty(d[1]))this._pathToModelDefs[b]=
this._pathToModelDefs[b].replace(d[0],this._pathToModelDefs[d[1]]);else throw new MojoException("ModelDefResolver",d[0]+" variable cannot be found.",LOG_ERROR);if(null===this._pathToModelDefs["default"]||"undefined"===typeof this._pathToModelDefs["default"])throw new MojoException("ModelDefResolver","pathToModelDefs must contain a 'default' entry.",LOG_ERROR);}else if("string"===typeof a.pathToModelDefs)this._pathToModelDefs={"default":a.pathToModelDefs};else throw new MojoException("ModelDefResolver",
"pathToModelDefs is invalid.  Must be an object or string.",LOG_ERROR);if("object"===typeof a.nameToDefMap)this._map=a.nameToDefMap;else throw new MojoException("ModelDefResolver","nameToDefMap is invalid.  Must be an object",LOG_ERROR);"string"===typeof a.defaultExtension&&(this._defaultExtension=a.defaultExtension)},loadModelDefinitions:function(a,b){var d=this._pathToModelDefs["default"];d.match(/\/$/)||(d+="/");var c=a.substr(0,a.lastIndexOf("/")+1);try{jQuery.ajax({url:d+a,context:this,success:function(a){a=
"string"===typeof a?jQuery.parseJSON(a):a;_.each(a,function(a,b){this._loadedDefs[d+c+b]=a},this);_.isFunction(b)&&b.call(!0)},error:function(){TRACE("Failed to load combined model definitions",["modelDefResolver","loadModelDefinitions"],Mojo.utils.trace.ERROR);_.isFunction(b)&&b.call(!1)}})}catch(e){if(e instanceof MojoException)throw e;throw new MojoException("Flow Resolver","UNKNOWN EXCEPTION:  "+flow,LOG_ERROR,e);}},getDef:function(a,b,d,c){var e="default",f=null,g=null;(f=Mojo.constants.nameSpaceRegex.exec(a))&&
(e=f[1]);f=this._pathToModelDefs[e];f||(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Model Def Resolver","Path alias '"+e+"' not found, using default path",LOG_INFO)),f=this._pathToModelDefs["default"]);f.match(/\/$/)||(f+="/");b?g=b:!b&&this._map[a]&&(g=this._map[a],TRACE("ALIAS REF: '"+a+"' --\> "+g,[Mojo.constants.components.MODELDEF_RESOLVER]));a=RegExp("^(.*)("+this._defaultExtension+")$");g&&!a.exec(g)&&(g+=this._defaultExtension);var l=f+g;if(g){if(this._loadedDefs[l])return TRACE("Loading model def out of memory: '"+
g+"'",[Mojo.constants.components.MODELDEF_RESOLVER]),this._returnDef(this._loadedDefs[l],d);TRACE("Loading model def off server: '"+g+"' --\> "+l,[Mojo.constants.components.MODELDEF_RESOLVER]);if(_.isFunction(d))this._loadDefAsync(l,function(a){if(a){this._loadedDefs[l]=a;d(a)}else _.isFunction(c)&&c()},this);else return g=this._loadDef(l),this._loadedDefs[l]=g}else return this._returnDef(null,d)},isBusy:function(){return 0<this._loadCount},_returnDef:function(a,b){return _.isFunction(b)?(b(a),null):
a},_loadDef:function(a){try{var b;jQuery.ajaxSetup({async:!1});jQuery.getJSON(a,function(a){b=a}).error(function(b,d,f){"parsererror"===d?Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Model Def Resolver","Parse Error: "+a+" - Context: "+f,LOG_ERROR)):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Model Def Resolver","Load Error: "+a+" - Context: "+f,LOG_ERROR))});jQuery.ajaxSetup({async:!0});return b}catch(d){if(d instanceof MojoException)throw d;throw new MojoException("Model Def Resolver",
"UNKNOWN EXCEPTION:  "+a,LOG_ERROR,d);}},_loadCount:0,_loadDefAsync:function(a,b,d){var c=this;try{jQuery.ajax({url:a,success:function(a){a="string"===typeof a?jQuery.parseJSON(a):a;c._loadCount-=1;b.call(d,a)},error:function(a,e){c._loadCount-=1;TRACE("parsererror"===e?"Parse Error":"Load Error",["modelDefResolver","_loadDefAsync"],Mojo.utils.trace.ERROR);b.call(d,null)}})}catch(e){if(e instanceof MojoException)throw e;throw new MojoException("Flow Resolver","UNKNOWN EXCEPTION:  "+flow,LOG_ERROR,
e);}}});Mojo.components.screenTransitioner=Mojo.interfaces.screenTransitioner.extend({construct:function(){},transitionScreen:function(a){var b=a.targetId,d=a.callback;a.bShow?jQuery("#"+b).fadeIn(300,d):jQuery("#"+b).fadeOut(300,d)}});
Mojo.uiComponents.registry=function(){var a={};return{registerComponentClass:function(b,d){if(!_.has(a,b)){if("uiComponent"!==(new d).interfaceType)throw new MojoException("Mojo.components.registry","Register: component must implement a Mojo UI interface: ",LOG_ERROR);a[b]=d;TRACE("added UI component, name = "+b)}},createComponent:function(b){if(_.has(a,b))return new a[b];Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.uiComponents.registry","createComponent: component: '"+
b+"' does not exist",LOG_ERROR));return null}}}();
Mojo.components.viewResolver=Mojo.interfaces.viewResolver.extend({kWildCard:"*",construct:function(a){this._map=this._pathToViews=null;if(!a)throw new MojoException("View Resolver","missing options",LOG_ERROR);if("object"===typeof a.pathToViews){this._pathToViews=a.pathToViews;for(var b in this._pathToViews)for(var d;null!=(d=/\$\{(.*?)\}/g.exec(this._pathToViews[b]));)if(this._pathToViews.hasOwnProperty(d[1]))this._pathToViews[b]=this._pathToViews[b].replace(d[0],this._pathToViews[d[1]]);else throw new MojoException("View Resolver",
d[0]+" variable cannot be found.",LOG_ERROR);if(!this._pathToViews["default"])throw new MojoException("View Resolver","pathToViews must contain a 'default' entry.",LOG_ERROR);}else if("string"===typeof a.pathToViews)this._pathToViews={"default":a.pathToViews};else throw new MojoException("View Resolver","pathToView is invalid.  Must be an object or string.",LOG_ERROR);if("object"===typeof a.aliasMap)this._map=a.aliasMap;else throw new MojoException("View Resolver","aliasMap is invalid.  Must be an object",
LOG_ERROR);},resolve:function(a){var b="default",d=a,c=null,e=null;this._abTestResolver||(this._abTestResolver=Mojo.getComponent(Mojo.interfaces.abTestResolver));if(c=Mojo.constants.nameSpaceRegex.exec(a))b=c[1],d=c[2];c=this._pathToViews[b];c||(Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("View Resolver","Path alias '"+b+"' not found, using default path",LOG_INFO)),c=this._pathToViews["default"]);c.match(/\/$/)||(c+="/");this._map[a]?(e=this._map[a],TRACE("ALIAS REF: '"+a+
"' --\> "+e,[Mojo.constants.components.VIEW_RESOLVER])):this._map[this.kWildCard]&&(e=d+this._map[this.kWildCard],TRACE("WILDCARD REF: '"+d+"' --\> "+e,[Mojo.constants.components.VIEW_RESOLVER]));e&&(c+=e,TRACE("FULL PATH RESOLUTION: '"+a+"' --\> "+c,[Mojo.constants.components.VIEW_RESOLVER]));if(b=this._abTestResolver.getABTestPage(a,c))TRACE(a+" --\> "+b,[Mojo.constants.components.VIEW_RESOLVER,"ABTEST"]),c=b;return c},isBusy:function(){return!1}});
Mojo.application.applicationController=function(){function a(a,b,d){if(k)try{k.getNextView(a,function(a){c(m,a,b,d)})}catch(e){g(e)}else g(new MojoException("Mojo.application.applicationController","_doNext: You must start a flow before navigating",LOG_ERROR))}function b(a,b,d,e){if(a)if(k)try{"string"===typeof a&&(a=a.split(Mojo.flow.constants.kNavigationSeperator),jQuery.each(a,function(c,e){a[c]=0==c?new Mojo.flow.flowJumpObj(e,d,b):new Mojo.flow.flowJumpObj(e)})),k.navigateTo(a,function(a){c(m,
a,b,e)})}catch(f){g(f)}else g(new MojoException("Mojo.application.applicationController","_jumpTo: You must start a flow before jumping",LOG_ERROR));else g(new MojoException("Mojo.application.applicationController","_jumpTo: No flow name specifed",LOG_ERROR))}function d(a){f();t=null;p=!1;k=null;Mojo.publishEvent(Mojo.constants.events.kEndMojo,a)}function c(a,b,c,d){function f(){n.mark("rslv");var b=r.resolve(o);n.captureTimeFromMark("resolveTime","rslv");n.mark("load");var c=jQuery("#"+a);jQuery.ajax({url:b,
dataType:"html",success:function(a){var d=a.replace(A,""),a=a.match(A);_.each(a,function(a){try{if(0<a.substring(0,a.indexOf(">")+1).indexOf("src"))jQuery(document).append(a);else{var c=a.substring(a.indexOf(">")+1,a.lastIndexOf("<"));jQuery.globalEval(c)}}catch(d){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.ApplicationController","failed to eval script in: "+b,LOG_ERROR,d))}},this);c.html(d);k()},error:function(a,c,d){g(new MojoException("Mojo.application.applicationController",
"Error loading page: "+b+" MORE CONTEXT: "+d,LOG_ERROR))},complete:function(){n.captureTimeFromMark("loadTime","load")}})}function k(){p=!1;if(window[Mojo.constants.scopes.kViewScope]&&"function"===typeof window[Mojo.constants.scopes.kViewScope].onStart)try{TRACE("Calling onStart for page: "+t),window[Mojo.constants.scopes.kViewScope].onStart()}catch(f){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Page: '"+t+"' threw an exception onStart",LOG_WARNING))}m?(window[Mojo.constants.scopes.kViewScope]||
(window[Mojo.constants.scopes.kViewScope]={}),window[Mojo.constants.scopes.kViewScope].__mojoViewPort=m):g(new MojoException("Mojo.application.applicationController","start: No view port specifed",LOG_ERROR));Mojo.publishEvent(Mojo.constants.events.kPageLoaded,{pageAlias:t});try{n.mark("bind"),Mojo.applyBindings(a),n.captureTimeFromMark("bindTime","bind")}catch(l){g(l)}o!==t&&e(!0,a,c);t=o;jQuery(":input:enabled:visible:first",jQuery("#"+m)).focus();Mojo.publishEvent(Mojo.constants.events.kPageFinalized,
{pageAlias:t,pageProfile:n});window[Mojo.constants.scopes.kViewScope]&&"function"===typeof window[Mojo.constants.scopes.kViewScope].onReady&&(TRACE("Calling onReady for page: "+t),window[Mojo.constants.scopes.kViewScope].onReady());if(q){var r=jQuery("#"+q);r[0]?jQuery("html, body").animate({scrollTop:r.position().top},200):Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Page Request: '"+b+"' could not find the Hash: '"+q+"' in Page: "+htmlPage,LOG_WARNING))}n.captureTimeFromMark("total");
TRACE("Navigation Time: "+n.getCapture("navTime")+"ms, Resolve Time: "+n.getCapture("resolveTime")+"ms, Load Time: "+n.getCapture("loadTime")+"ms, Binding Time: "+n.getCapture("bindTime")+"ms, Total Time: "+n.getCapture("total")+"ms",["PROFILE",t]);n.setName(t);Mojo.publishEvent(Mojo.constants.events.kProfile,n);x.reset();x.setName(t);x.mark("timeOnPage");d&&d()}n.captureTimeFromMark("navTime","nav");Mojo.publishEvent(Mojo.constants.events.kBeforePageLoad,{pageAlias:b});window[Mojo.constants.scopes.kViewScope]=
{};Mojo.addModel({modelName:Mojo.constants.scopes.kViewScope,async:!1});if(p){var l=b.split("#"),o=l[0],q=l[1];o!==t?e(!1,a,c,f):f()}else TRACE("_loadContent returning without loading page because the navigating flag is not set")}function e(a,b,c,d){Mojo.getComponent("screenTransitioner").transitionScreen({targetId:b,bShow:a,options:c,callback:d})}function f(){x.captureTimeFromMark("customerTime","timeOnPage");TRACE("Customer time on page: "+x.getCapture("customerTime")+"ms",["PROFILE",t]);Mojo.publishEvent(Mojo.constants.events.kProfile,
x);Mojo.publishEvent(Mojo.constants.events.kBeforePageUnload,{pageAlias:t,customerProfile:x});jQuery("input:focus").trigger("blur");jQuery("html, body").animate({scrollTop:0},200);Mojo.inputStrategies.validator.engine.hideErrorTooltips();if(window[Mojo.constants.scopes.kViewScope]&&"function"===typeof window[Mojo.constants.scopes.kViewScope].onEnd)try{TRACE("Calling onEnd for page: "+t),window[Mojo.constants.scopes.kViewScope].onEnd()}catch(a){Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Page: '"+
t+"' threw an exception onEnd",LOG_WARNING))}Mojo.unSubscribe(window[Mojo.constants.scopes.kViewScope]);Mojo.removeModel(Mojo.constants.scopes.kViewScope);var b=window[Mojo.constants.scopes.kViewScope]?window[Mojo.constants.scopes.kViewScope].__mojoViewPort:null;b&&Mojo.unbind(b);window[Mojo.constants.scopes.kViewScope]=null}function g(a){p=!1;a=a instanceof MojoException?a:new MojoException("UNKNOWN EXCEPTION",a.type+" "+a.message,LOG_ERROR,a);Mojo.publishEvent(Mojo.constants.events.kException,a)}
var l=null,k=null,o=[],r=null,m=null,p=!1,q=null,t=null,w=null,v=!1,n=new Mojo.utils.profiler("VIEW_PROFILE"),x=new Mojo.utils.profiler("CUSTOMER_TIME"),A=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,s={init:function(){l=Mojo.utils.uuid();m=m||Mojo.application.options.viewPortId;r=Mojo.getComponent(Mojo.interfaces.viewResolver);w=Mojo.getComponent("modalwindow");r||_throwError("View Resolver not registered in framework");m||_throwError("No view port specifed");Mojo.subscribeForEvent(Mojo.constants.events.kException,
s.handleUIException,s);Mojo.subscribeForEvent(Mojo.constants.events.kNavigation,s.handleNavEvent,s);Mojo.addModel({modelName:Mojo.constants.scopes.kApplicationScope,async:!1});Mojo.setData(Mojo.constants.scopes.kApplicationScope,"version",Mojo.getVersion())},setViewPort:function(a){m=a},handleNavEvent:function(c){if(c)if(k&&k.isBusy())TRACE("Not navigating while Flow Controller is busy");else{p&&TRACE("Previous navigation is in progress");var d=!0;c.hasOwnProperty("validate")&&!1==c.validate&&(d=
!1);c.nav&&"back"===c.nav&&!1==c.hasOwnProperty("validate")?d=MojoOptions.validationOptions.validateOnBack:c.jump&&!1==c.hasOwnProperty("validate")?d=MojoOptions.validationOptions.validateOnJump:c.load&&!1==c.hasOwnProperty("validate")?d=MojoOptions.validationOptions.validateOnJump:c.flow&&!1==c.hasOwnProperty("validate")&&(d=MojoOptions.validationOptions.validateOnJump);d&&!this.validateSection(m)?p=!1:(t&&f(),n.reset(),n.mark("nav"),p=!0,c.nav?a(c.nav,c):c.jump?b(c.jump,c):c.load?s.loadPage(c.load,
c):c.flow&&s.startflow(c.flow,c))}},startflow:function(c,e,f,g){n.reset();n.mark("nav");k&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.application.applicationController","Starting Mojo flow with pre-existing flow.",LOG_INFO));p=!0;var l={};if(e&&e.modal){k&&o.push(k);k=Mojo.flow.controller();var m=function(b){d();k=o.pop();b?s.endModal(e,function(){g&&g(b);e.navWhenDone&&(p=!0,a(b.value,b.options))}):g&&g()};s.startModal(e,m);l.onEndCB=m;k.init(l)}else k||(k=Mojo.flow.controller(),
l.onEndCB=d,k.init(l));b(c,e,f)},loadPage:function(b,d,e){n.reset();n.mark("nav");d=d||{};k&&Mojo.publishEvent(Mojo.constants.events.kException,new MojoException("Mojo.application.applicationController","Loading a page when the controller is running. This can cause problems if you want to resume the controller",LOG_WARNING));p=!0;d.modal&&s.startModal(d,function(b){s.endModal(d,function(){d.navWhenDone&&(p=!0,a(b.value,b.options))})});c(d.viewPort||m,b,d,e)},forceEnd:function(){d()},getSessionId:function(){return l},
getCurrentFlowVariable:function(a){return k?k.getCurrentFlowVariable(a):null},getCurrentFlowScopeName:function(){return k?k.getCurrentFlowScopeName():null},validateSection:function(a){if(!MojoOptions.validationOptions.useValidator)return!0;var b=!0,b=Mojo.inputStrategies.validator.engine,c={};window[Mojo.constants.scopes.kViewScope]&&window[Mojo.constants.scopes.kViewScope].validationOptions&&(c=VIEW_SCOPE.validationOptions);return b=b.validateAll(a,c)},startModal:function(a,b){w.show(a.closeButton,
function(){_.isFunction(b)&&b();f();s.endModal(a)});v=!0;q={viewPort:m,view:t};m=w.getViewPortId()},endModal:function(a,b){w.hide();v=!1;q&&(m=q.viewPort,t=q.view);q=null;t?(p=!0,c(m,t,a,b)):b&&b()},inModal:function(){return v},handleUIException:function(a){var b="Application ("+MojoOptions.appId+") "+a.logType+": Component="+a.component+" Msg="+a.msg;a.exeptionObj&&(b+="\nCaused by:\n"+a.exeptionObj.message);a.logType===LOG_ERROR&&MojoOptions.showMojoExceptions&&alert(b);TRACE(b,null,a.logType)}};
return s}();
Mojo.application.options={appId:null,viewPortId:null,ABTestConfig:{},viewResolverOptions:{pathToViews:"",aliasMap:{}},flowResolverOptions:{pathToFlows:"",aliasMap:{}},actionOptions:{pathToActions:""},modelDefConfig:{pathToModelDefs:"",nameToDefMap:{}},validationOptions:{tooltipPosition:"top",hideOnFocus:!1,showOnlyOne:!1,showMultipleErrorsPerInput:!1,suppressErrors:!1,validateOnBack:!1,validateOnJump:!1,useValidator:!0},useFormatter:!0,defaultDAO:null,defaultModelClass:"Mojo.model.dataModel",enableTraceConsole:!0,
showMojoExceptions:!1,treatNullAsBlank:!1,defaultModelValue:null,setOption:function(a,b){if("validationOptions"===a)if("object"===typeof b){var d=this;jQuery.each(b,function(b,e){"undefined"!=typeof d[a][b]?d[a][b]=e:TRACE("Invalid Validation Option: "+b+" - ignoring",["OPTIONS"],Mojo.utils.trace.WARN)})}else TRACE("Invalid Validation Option, must be an object:"+b+" - ignoring",["OPTIONS"],Mojo.utils.trace.WARN);else"undefined"!=typeof this[a]?this[a]=b:TRACE("Invalid Option: "+a+" - ignoring",["OPTIONS"],
Mojo.utils.trace.WARN)},validate:function(){this.appId||this._throwError("Missing App Id")},_throwError:function(a){throw new MojoException("Mojo.Options",a,LOG_ERROR);}};Mojo.exportSymbol("MojoOptions",Mojo.application.options);
(function(){var a=this,b=a._,d={},c=Array.prototype,e=Object.prototype,f=c.push,g=c.slice,l=c.concat,k=e.toString,o=e.hasOwnProperty,r=c.forEach,m=c.map,p=c.reduce,q=c.reduceRight,t=c.filter,w=c.every,v=c.some,n=c.indexOf,x=c.lastIndexOf,e=Array.isArray,A=Object.keys,s=Function.prototype.bind,h=function(a){if(a instanceof h)return a;if(!(this instanceof h))return new h(a);this._wrapped=a};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=
h):a._=h;h.VERSION="1.4.2";var u=h.each=h.forEach=function(a,b,c){if(null!=a)if(r&&a.forEach===r)a.forEach(b,c);else if(a.length===+a.length)for(var e=0,f=a.length;e<f&&b.call(c,a[e],e,a)!==d;e++);else for(e in a)if(h.has(a,e)&&b.call(c,a[e],e,a)===d)break};h.map=h.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(u(a,function(a,e,y){d[d.length]=b.call(c,a,e,y)}),d)};h.reduce=h.foldl=h.inject=function(a,b,c,d){var e=2<arguments.length;null==a&&(a=[]);if(p&&a.reduce===p)return d&&
(b=h.bind(b,d)),e?a.reduce(b,c):a.reduce(b);u(a,function(a,y,f){e?c=b.call(d,c,a,y,f):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c};h.reduceRight=h.foldr=function(a,b,c,d){var e=2<arguments.length;null==a&&(a=[]);if(q&&a.reduceRight===q)return d&&(b=h.bind(b,d)),2<arguments.length?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f)var g=h.keys(a),f=g.length;u(a,function(h,k,l){k=g?g[--f]:--f;e?c=b.call(d,c,a[k],k,l):(c=a[k],e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");
return c};h.find=h.detect=function(a,b,c){var d;return F(a,function(a,e,y){if(b.call(c,a,e,y))return d=a,!0}),d};h.filter=h.select=function(a,b,c){var d=[];return null==a?d:t&&a.filter===t?a.filter(b,c):(u(a,function(a,e,y){b.call(c,a,e,y)&&(d[d.length]=a)}),d)};h.reject=function(a,b,c){var d=[];return null==a?d:(u(a,function(a,e,y){b.call(c,a,e,y)||(d[d.length]=a)}),d)};h.every=h.all=function(a,b,c){b||(b=h.identity);var e=!0;return null==a?e:w&&a.every===w?a.every(b,c):(u(a,function(a,y,f){if(!(e=
e&&b.call(c,a,y,f)))return d}),!!e)};var F=h.some=h.any=function(a,b,c){b||(b=h.identity);var e=!1;return null==a?e:v&&a.some===v?a.some(b,c):(u(a,function(a,y,f){if(e||(e=b.call(c,a,y,f)))return d}),!!e)};h.contains=h.include=function(a,b){var c=!1;return null==a?c:n&&a.indexOf===n?-1!=a.indexOf(b):(c=F(a,function(a){return a===b}),c)};h.invoke=function(a,b){var c=g.call(arguments,2);return h.map(a,function(a){return(h.isFunction(b)?b:a[b]).apply(a,c)})};h.pluck=function(a,b){return h.map(a,function(a){return a[b]})};
h.where=function(a,b){return h.isEmpty(b)?[]:h.filter(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})};h.max=function(a,b,c){if(!b&&h.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&h.isEmpty(a))return-Infinity;var d={computed:-Infinity};return u(a,function(a,e,y){e=b?b.call(c,a,e,y):a;e>=d.computed&&(d={value:a,computed:e})}),d.value};h.min=function(a,b,c){if(!b&&h.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&h.isEmpty(a))return Infinity;
var d={computed:Infinity};return u(a,function(a,e,y){e=b?b.call(c,a,e,y):a;e<d.computed&&(d={value:a,computed:e})}),d.value};h.shuffle=function(a){var b,c=0,d=[];return u(a,function(a){b=h.random(c++);d[c-1]=d[b];d[b]=a}),d};var C=function(a){return h.isFunction(a)?a:function(b){return b[a]}};h.sortBy=function(a,b,c){var d=C(b);return h.pluck(h.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;
if(c<d||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var H=function(a,b,c,d){var e={},f=C(b);return u(a,function(b,h){var g=f.call(c,b,h,a);d(e,g,b)}),e};h.groupBy=function(a,b,c){return H(a,b,c,function(a,b,c){(h.has(a,b)?a[b]:a[b]=[]).push(c)})};h.countBy=function(a,b,c){return H(a,b,c,function(a,b){h.has(a,b)||(a[b]=0);a[b]++})};h.sortedIndex=function(a,b,c,d){for(var c=null==c?h.identity:C(c),b=c.call(d,b),e=0,f=a.length;e<f;){var g=e+f>>>1;c.call(d,a[g])<b?e=g+1:f=g}return e};
h.toArray=function(a){return a?a.length===+a.length?g.call(a):h.values(a):[]};h.size=function(a){return a.length===+a.length?a.length:h.keys(a).length};h.first=h.head=h.take=function(a,b,c){return null!=b&&!c?g.call(a,0,b):a[0]};h.initial=function(a,b,c){return g.call(a,0,a.length-(null==b||c?1:b))};h.last=function(a,b,c){return null!=b&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]};h.rest=h.tail=h.drop=function(a,b,c){return g.call(a,null==b||c?1:b)};h.compact=function(a){return h.filter(a,
function(a){return!!a})};var I=function(a,b,c){return u(a,function(a){h.isArray(a)?b?f.apply(c,a):I(a,b,c):c.push(a)}),c};h.flatten=function(a,b){return I(a,b,[])};h.without=function(a){return h.difference(a,g.call(arguments,1))};h.uniq=h.unique=function(a,b,c,d){var c=c?h.map(a,c,d):a,e=[],f=[];return u(c,function(c,d){if(b?!d||f[f.length-1]!==c:!h.contains(f,c))f.push(c),e.push(a[d])}),e};h.union=function(){return h.uniq(l.apply(c,arguments))};h.intersection=function(a){var b=g.call(arguments,1);
return h.filter(h.uniq(a),function(a){return h.every(b,function(b){return 0<=h.indexOf(b,a)})})};h.difference=function(a){var b=l.apply(c,g.call(arguments,1));return h.filter(a,function(a){return!h.contains(b,a)})};h.zip=function(){for(var a=g.call(arguments),b=h.max(h.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=h.pluck(a,""+d);return c};h.object=function(a,b){for(var c={},d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c};h.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=
a.length;if(c){if("number"!=typeof c)return d=h.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(n&&a.indexOf===n)return a.indexOf(b,c);for(;d<e;d++)if(a[d]===b)return d;return-1};h.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(x&&a.lastIndexOf===x)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=d?c:a.length;c--;)if(a[c]===b)return c;return-1};h.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<
d;)f[e++]=a,a+=c;return f};var D=function(){};h.bind=function(a,b){var c,d;if(a.bind===s&&s)return s.apply(a,g.call(arguments,1));if(!h.isFunction(a))throw new TypeError;return d=g.call(arguments,2),c=function(){if(this instanceof c){D.prototype=a.prototype;var e=new D,f=a.apply(e,d.concat(g.call(arguments)));return Object(f)===f?f:e}return a.apply(b,d.concat(g.call(arguments)))}};h.bindAll=function(a){var b=g.call(arguments,1);return 0==b.length&&(b=h.functions(a)),u(b,function(b){a[b]=h.bind(a[b],
a)}),a};h.memoize=function(a,b){var c={};return b||(b=h.identity),function(){var d=b.apply(this,arguments);return h.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}};h.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};h.defer=function(a){return h.delay.apply(h,[a,1].concat(g.call(arguments,1)))};h.throttle=function(a,b){var c,d,e,f,g,k,l=h.debounce(function(){g=f=!1},b);return function(){c=this;d=arguments;return e||(e=setTimeout(function(){e=null;g&&
(k=a.apply(c,d));l()},b)),f?g=!0:(f=!0,k=a.apply(c,d)),l(),k}};h.debounce=function(a,b,c){var d,e;return function(){var f=this,h=arguments,g=c&&!d;return clearTimeout(d),d=setTimeout(function(){d=null;c||(e=a.apply(f,h))},b),g&&(e=a.apply(f,h)),e}};h.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}};h.wrap=function(a,b){return function(){var c=[a];return f.apply(c,arguments),b.apply(this,c)}};h.compose=function(){var a=arguments;return function(){for(var b=
arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};h.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};h.keys=A||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)h.has(a,c)&&(b[b.length]=c);return b};h.values=function(a){var b=[],c;for(c in a)h.has(a,c)&&b.push(a[c]);return b};h.pairs=function(a){var b=[],c;for(c in a)h.has(a,c)&&b.push([c,a[c]]);return b};h.invert=function(a){var b={},c;for(c in a)h.has(a,
c)&&(b[a[c]]=c);return b};h.functions=h.methods=function(a){var b=[],c;for(c in a)h.isFunction(a[c])&&b.push(c);return b.sort()};h.extend=function(a){return u(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a};h.pick=function(a){var b={},d=l.apply(c,g.call(arguments,1));return u(d,function(c){c in a&&(b[c]=a[c])}),b};h.omit=function(a){var b={},d=l.apply(c,g.call(arguments,1)),e;for(e in a)h.contains(d,e)||(b[e]=a[e]);return b};h.defaults=function(a){return u(g.call(arguments,1),function(b){for(var c in b)null==
a[c]&&(a[c]=b[c])}),a};h.clone=function(a){return h.isObject(a)?h.isArray(a)?a.slice():h.extend({},a):a};h.tap=function(a,b){return b(a),a};var z=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof h&&(a=a._wrapped);b instanceof h&&(b=b._wrapped);var e=k.call(a);if(e!=k.call(b))return!1;switch(e){case "[object String]":return a==""+b;case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==
b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a);d.push(b);var f=0,g=!0;if("[object Array]"==e){if(f=a.length,g=f==b.length)for(;f--&&(g=z(a[f],b[f],c,d)););}else{var e=a.constructor,l=b.constructor;if(e!==l&&(!h.isFunction(e)||!(e instanceof e&&h.isFunction(l)&&l instanceof l)))return!1;for(var m in a)if(h.has(a,m)&&(f++,!(g=h.has(b,m)&&z(a[m],b[m],c,d))))break;
if(g){for(m in b)if(h.has(b,m)&&!f--)break;g=!f}}return c.pop(),d.pop(),g};h.isEqual=function(a,b){return z(a,b,[],[])};h.isEmpty=function(a){if(null==a)return!0;if(h.isArray(a)||h.isString(a))return 0===a.length;for(var b in a)if(h.has(a,b))return!1;return!0};h.isElement=function(a){return!!a&&1===a.nodeType};h.isArray=e||function(a){return"[object Array]"==k.call(a)};h.isObject=function(a){return a===Object(a)};u("Arguments,Function,String,Number,Date,RegExp".split(","),function(a){h["is"+a]=function(b){return k.call(b)==
"[object "+a+"]"}});h.isArguments(arguments)||(h.isArguments=function(a){return!!a&&!!h.has(a,"callee")});"function"!=typeof/./&&(h.isFunction=function(a){return"function"==typeof a});h.isFinite=function(a){return h.isNumber(a)&&isFinite(a)};h.isNaN=function(a){return h.isNumber(a)&&a!=+a};h.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==k.call(a)};h.isNull=function(a){return null===a};h.isUndefined=function(a){return void 0===a};h.has=function(a,b){return o.call(a,b)};h.noConflict=
function(){return a._=b,this};h.identity=function(a){return a};h.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};h.random=function(a,b){return null==b&&(b=a,a=0),a+(0|Math.random()*(b-a+1))};var E={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};E.unescape=h.invert(E.escape);var J={escape:RegExp("["+h.keys(E.escape).join("")+"]","g"),unescape:RegExp("("+h.keys(E.unescape).join("|")+")","g")};h.each(["escape","unescape"],function(a){h[a]=function(b){return null==
b?"":(""+b).replace(J[a],function(b){return E[a][b]})}});h.result=function(a,b){if(null==a)return null;var c=a[b];return h.isFunction(c)?c.call(a):c};h.mixin=function(a){u(h.functions(a),function(b){var c=h[b]=a[b];h.prototype[b]=function(){var a=[this._wrapped];f.apply(a,arguments);a=c.apply(h,a);return this._chain?h(a).chain():a}})};var B=0;h.uniqueId=function(a){var b=B++;return a?a+b:b};h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var G=
/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;h.template=function(a,b,c){var c=h.defaults({},c,h.templateSettings),d=RegExp([(c.escape||G).source,(c.interpolate||G).source,(c.evaluate||G).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){f+=a.slice(e,h).replace(L,function(a){return"\\"+K[a]});f+=c?"'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?"'+\n((__t=("+d+"))==null?'':__t)+\n'":g?"';\n"+g+
"\n__p+='":"";e=h+b.length});f+="';\n";c.variable||(f="with(obj||{}){\n"+f+"}\n");f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(c.variable||"obj","_",f)}catch(k){throw k.source=f,k;}if(b)return g(b,h);b=function(a){return g.call(this,a,h)};return b.source="function("+(c.variable||"obj")+"){\n"+f+"}",b};h.chain=function(a){return h(a).chain()};h.mixin(h);u("pop,push,reverse,shift,sort,splice,unshift".split(","),
function(a){var b=c[a];h.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),(a=="shift"||a=="splice")&&c.length===0&&delete c[0],this._chain?h(c).chain():c}});u(["concat","join","slice"],function(a){var b=c[a];h.prototype[a]=function(){var a=b.apply(this._wrapped,arguments);return this._chain?h(a).chain():a}});h.extend(h.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);
(function(a,b,d){function c(a){var b={},c=/^jQuery\d+$/;d.each(a.attributes,function(a,d){d.specified&&!c.test(d.name)&&(b[d.name]=d.value)});return b}function e(a,c){var e=d(this);if(this.value==e.attr("placeholder")&&e.hasClass("placeholder"))if(e.data("placeholder-password")){e=e.hide().next().show().attr("id",e.removeAttr("id").data("placeholder-id"));if(!0===a)return e[0].value=c;e.focus()}else this.value="",e.removeClass("placeholder"),this==b.activeElement&&this.select()}function f(){var a,
b=d(this),f=this.id;if(""==this.value){if("password"==this.type){if(!b.data("placeholder-textinput")){try{a=b.clone().attr({type:"text"})}catch(g){a=d("<input>").attr(d.extend(c(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":f}).bind("focus.placeholder",e);b.data({"placeholder-textinput":a,"placeholder-id":f}).before(a)}b=b.removeAttr("id").hide().prev().attr("id",f).show()}b.addClass("placeholder");b[0].value=b.attr("placeholder")}else b.removeClass("placeholder")}
var g="placeholder"in b.createElement("input"),l="placeholder"in b.createElement("textarea"),k=d.fn,o=d.valHooks;g&&l?(k=k.placeholder=function(){return this},k.input=k.textarea=!0):(k=k.placeholder=function(){this.filter((g?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder");return this},k.input=g,k.textarea=l,k={get:function(a){var b=d(a);return b.data("placeholder-enabled")&&b.hasClass("placeholder")?
"":a.value},set:function(a,c){var g=d(a);if(!g.data("placeholder-enabled"))return a.value=c;""==c?(a.value=c,a!=b.activeElement&&f.call(a)):g.hasClass("placeholder")?e.call(a,!0,c)||(a.value=c):a.value=c;return g}},g||(o.input=k),l||(o.textarea=k),d(function(){d(b).delegate("form","submit.placeholder",function(){var a=d(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),d(a).bind("beforeunload.placeholder",function(){d(".placeholder").each(function(){this.value=""})}))})(this,document,
jQuery);